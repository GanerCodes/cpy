parser_main = exprs
parser_comment = (â ¶str âˆ¨ comment âˆ¨ ~â€¹.â€º)*

exprs = W? (â ¶expr W?)*
expr = (
    (kw_pfx_colon_expr = â ¶norm_expr_atom+)
        âˆ¨ (kw_pfx_expr = â ¶vkw_pfx norm_expr)
          âˆ¨ (norm_expr = â ¶vkw_pfx_colon ó°†´E? â†· (expr_not_colon? ó°†´':') expr?))

expr_not_colon = (Â¬':' â ¶norm_expr_atom)+
expr_not_comma = (Â¬',' â ¶norm_expr_atom)+

vkw_pfx_colon = â®kw_spec kw_pfx_colon âˆ¨ kw_pfx_colon â®text_breaker
vkw_pfx       = â®kw_spec kw_pfx       âˆ¨ kw_pfx       â®text_breaker
vkw           = â®kw_spec kw           âˆ¨ kw           â®text_breaker

norm_expr_atom = (lamb âˆ¨ â ¶gen_expr_atom) ó°†´E?
gen_expr_atom = group âˆ¨ â ¶str âˆ¨ var_spec âˆ¨ oper âˆ¨ â ¶vkw âˆ¨ â ¶script âˆ¨ var
var = (Â¬W Â¬oper Â¬var_spec Â¬script ~â€¹[^ğ—®-ğ˜‡ğš²â¥Œâ†¦â‘ â‘¡â‘¢â‘£ó°…‚"'\[\](){}â…â†ã€šã€›âŸ¨âŸ©â€¹ â›â›â›â€º]â€º)+

group = ~â€¹[\[({â…âŸ¨ã€š]â€º (ó°†´W? â†· exprs) ~â€¹[\])}â†âŸ©ã€›]â€º

oper = (
    (oper_mod_l = ~â€¹[âŸ¥]*â€º)
     oper_lit
    (oper_mod_r = ~â€¹[Â´êœ áµœâŸ¤]*â€º))

script = (
    (supscript = ~â€¹[áµƒáµ‡á¶œáµˆáµ‰á¶ áµÊ°â±Ê²áµË¡áµâ¿áµ’áµ–î ‡Ê³Ë¢áµ—áµ˜áµ›Ê·Ë£Ê¸á¶»á´¬á´®ó°€‚á´°á´±ó°€…á´³á´´á´µá´¶á´·á´¸á´¹á´ºá´¼á´¾ó°€á´¿ó°€’áµ€áµâ±½áµ‚ó°€—ó°€˜ó°€™ó°Œó°ó°ó°ó°ó°‘ó°’ó°“â—Œó°”ó°•ó°–ó°—ó°˜ó°™ó°›ó°œó°ó°ó°Ÿó° ó°¡ó°¢ó°£ó°¤â—Œâ—Œó°€¶â—Œâ—Œó°€»ó°ó°ƒó°…ó°ˆó°Šó°‹â°Â¹Â²Â³â´âµâ¶â·â¸â¹â—Œó°±ó°‚‚ó°‚ó°²â—Œêœâºâ»áŸî â¼â½â¾â—Œâ—Œâ—ŒËœ]+â€º)
  âˆ¨ (subscript = ~â€¹[â‚î …î î â‚‘î î ‘â‚•áµ¢â±¼â‚–â‚—â‚˜â‚™ó°‚¼â‚šî †áµ£â‚›â‚œáµ¤áµ¥î ’â‚“î “î ”ó°‚“ó°‚”ó°‚•ó°‚–ó°‚—ó°‚˜ó°‚™ó°‚šó°‚›ó°‚œó°‚ó°‚ó°‚Ÿó°‚ ó°‚¡ó°‚¢ó°‚£ó°‚¤ó°‚¥ó°‚¦ó°‚§ó°‚¨ó°‚©ó°‚ªó°‚«ó°‚¬ó°ƒ¤ó°ƒ¥ó°ƒ¦ó°ƒ§ó°ƒ¨ó°ƒ©ó°ƒªó°ƒ«â—Œó°ƒ¬ó°ƒ­ó°ƒ®ó°ƒ¯ó°ƒ°ó°ƒ±ó°ƒ³ó°ƒ´ó°ƒµó°ƒ¶ó°ƒ·ó°ƒ¸ó°ƒ¹ó°ƒºó°ƒ»ó°ƒ¼â—Œâ—Œó°ƒó°ƒâ—Œó°ƒ“ó°ƒ™ó°ƒ›ó°ƒó°ƒ ó°ƒ¢ó°ƒ£â‚€â‚â‚‚â‚ƒâ‚„â‚…â‚†â‚‡â‚ˆâ‚‰ï¹•ó°„ó°„Ÿó°„ó°„ï¹–â—Œâ‚Šâ‚‹â¸î ‰â‚Œâ‚â‚ï¹ ï¹©ï¹ªâ—Œ]+â€º))

lamb = (
    ( 
        (lamb_h_py = ó°†´"lambda" â®text_breaker â ¶expr_not_colon ó°†´':')
      âˆ¨ (lamb_h_normal = 
            ó°†´'â¥Œ' ó°†´E? 
            â ¶((Â¬lamb_h_implicit lamb) âˆ¨ â ¶gen_expr_atom ó°†´E?)*
            ó°†´'â†¦' )
      âˆ¨ (lamb_h_preset = ~"[ğš²â‘ â‘¡â‘¢â‘£]")
      âˆ¨ (lamb_h_implicit = var ó°†´'â†¦') ó°†´E?)
    (lamb_b = (exprs ó°†´'ó°…‚') âˆ¨ expr_not_comma))

str = str_cpy âˆ¨ str_py âˆ¨ str_escape âˆ¨ str_spec_char
str_cpy = ó°†´'â€¹' (str_escape âˆ¨ str_sub âˆ¨ str_spec_char âˆ¨ str_guts)* ó°†´'â€º'
str_sub = ó°†´'ã€š' exprs ó°†´'ã€›'
str_spec_char = ~â€¹[ğ—®-ğ˜‡]â€º
str_guts = ~â€¹[^ã€šâ›â›â›â€º]+â€º
str_escape = ó°†´"â›â›" ~â€¹.â€º
str_py = ((â€¹"â€º (str_py_sub âˆ¨ ~â€¹[^"\\]+â€º)* â€¹"â€º)
       âˆ¨  (â€¹'â€º (str_py_sub âˆ¨ ~â€¹[^'\\]+â€º)* â€¹'â€º))

str_py_sub = ~â€¹\\.â€º

w = ~â€¹[ \t]+â€º
W = ~â€¹[ \t\n]+â€º
text_breaker = â®(E âˆ¨ kw_spec âˆ¨ var_spec âˆ¨ Â¬var)
E = w âˆ¨ â€¹â›â›\nâ€º

comment = ~â€¹((î¬¦|#)[^\n]*(\n|\Z))|(ğŸŸ‘[^ğŸŸ‘]*(ğŸŸ‘|\Z))|(Ö[^Ö]*(Ö|\Z))â€º