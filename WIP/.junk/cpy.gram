# -------------- PARSERS -------------- #

parser_main = exprs_n / W?
parser_comment = (str / comment / ~"."s)*

# -------------- DYNAMICS -------------- #

KEYWORDS = ~"%KEYWORDS%"
VAR_SPEC = ~"%VAR_SPECIAL%"
OPER_LIT = ~"%OPERATORS%"

# ------------- EXPRESSION ------------- #

exprs_n = W? (exprs W?)+
exprs = w? (expr w?)+
expr = lamb / _expr1
_expr1 = group / str / VAR_SPEC / oper / keyword / _script / variable

oper = oper_mod_l OPER_LIT oper_mod_r
oper_mod_l = ~"['âŸ¥']*"
oper_mod_r = ~"[Â´êœ áµœâŸ¤]*"

_script = superscript / subscript
superscript = ~"[áµƒáµ‡á¶œáµˆáµ‰á¶ áµÊ°â±Ê²áµË¡áµâ¿áµ’áµ–î ‡Ê³Ë¢áµ—áµ˜áµ›Ê·Ë£Ê¸á¶»á´¬á´®ó°€‚á´°á´±ó°€…á´³á´´á´µá´¶á´·á´¸á´¹á´ºá´¼á´¾ó°€á´¿ó°€’áµ€áµâ±½áµ‚ó°€—ó°€˜ó°€™ó°Œó°ó°ó°ó°ó°‘ó°’ó°“â—Œó°”ó°•ó°–ó°—ó°˜ó°™ó°›ó°œó°ó°ó°Ÿó° ó°¡ó°¢ó°£ó°¤â—Œâ—Œó°€¶ó°€·â—Œó°€»ó°ó°ƒó°…ó°ˆó°Šó°‹â°Â¹Â²Â³â´âµâ¶â·â¸â¹â—Œó°±ó°‚‚ó°‚ó°²â—Œêœâºâ»áŸî â¼â½â¾â—Œâ—Œâ—ŒËœ]+"
subscript = ~"[â‚î …î î â‚‘î î ‘â‚•áµ¢â±¼â‚–â‚—â‚˜â‚™ó°‚¼â‚šî †áµ£â‚›â‚œáµ¤áµ¥î ’â‚“î “î ”ó°‚“ó°‚”ó°‚•ó°‚–ó°‚—ó°‚˜ó°‚™ó°‚šó°‚›ó°‚œó°‚ó°‚ó°‚Ÿó°‚ ó°‚¡ó°‚¢ó°‚£ó°‚¤ó°‚¥ó°‚¦ó°‚§ó°‚¨ó°‚©ó°‚ªó°‚«ó°‚¬ó°ƒ¤ó°ƒ¥ó°ƒ¦ó°ƒ§ó°ƒ¨ó°ƒ©ó°ƒªó°ƒ«â—Œó°ƒ¬ó°ƒ­ó°ƒ®ó°ƒ¯ó°ƒ°ó°ƒ±ó°ƒ³ó°ƒ´ó°ƒµó°ƒ¶ó°ƒ·ó°ƒ¸ó°ƒ¹ó°ƒºó°ƒ»ó°ƒ¼â—Œâ—Œó°ƒó°ƒâ—Œó°ƒ“ó°ƒ™ó°ƒ›ó°ƒó°ƒ ó°ƒ¢ó°ƒ£â‚€â‚â‚‚â‚ƒâ‚„â‚…â‚†â‚‡â‚ˆâ‚‰ï¹•ó°„ó°„Ÿó°„ó°„ï¹–â—Œâ‚Šâ‚‹â¸î ‰â‚Œâ‚â‚ï¹ ï¹©ï¹ªâ—Œ]+"

keyword = KEYWORDS 
variable = (!VAR_SPEC !oper !W ~"[^ğ—®-ğ˜‡â›ğš²â¥Œâ†¦â‘ â‘¡â‘¢â‘£ó°…‚\\\"\\' \\[\\](){}â…â†ã€šã€›âŸ¨âŸ©â€¹â€º]")+

group = (('(' exprs_n? ')') / ('{' exprs_n? '}')
      /  ('[' exprs_n? ']') / ('â…' exprs_n? 'â†')
      /  ('âŸ¨' exprs_n? 'âŸ©') / ('ã€š' exprs_n? 'ã€›'))

# --------------- LAMBDAS --------------- #

lamb_h_exprs_n = W? (lamb_h_expr W?)+
lamb_h_expr = (!lamb_h_implicit lamb) / _expr1

lamb_h_normal   = "â¥Œ" lamb_h_exprs_n "â†¦"
lamb_h_implicit = variable "â†¦"
lamb_h_preset   = ~"[ğš²â‘ â‘¡â‘¢â‘£]"
lamb_h = lamb_h_normal / lamb_h_implicit / lamb_h_preset
lamb_b = (exprs_n? 'ó°…‚') / exprs
lamb = lamb_h lamb_b

# --------------- STRINGS --------------- #

str = special_str / py_str / str_escape / str_spec_char

special_str = ('â€¹' (str_escape / str_sub / str_spec_char / str_guts)* 'â€º')
str_sub = 'ã€š' exprs_n? 'ã€›'
str_guts = !str_spec_char ~"[^â›ã€šâ€º]+"
str_escape = ~"â›."
str_spec_char = ~"[ğ—®-ğ˜‡]"

py_str = (('"' (py_str_sub / ~"[^\\\\\"]+")* '"')
       /  ("'" (py_str_sub / ~"[^\\\\\']+")* "'"))
py_str_sub = ~"\\\\."

# whiespace
w = ~"[ \t]+"
W = ~"[ \t\n]+"
comment = ~"([î¬¦|#][^\\n]*(\\n|\\Z))|(ğŸŸ‘[^ğŸŸ‘]*(ğŸŸ‘|\\Z))|(Ö[^Ö]*(Ö|\\Z))"s