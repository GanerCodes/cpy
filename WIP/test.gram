# -------------- PARSERS -------------- #

parser_main = exprs_n
parser_comment = (str / comment / ~"."s)*

# -------------- DYNAMICS -------------- #

py_keywords = ~"%PY_KEYWORDS%"
var_special = ~"%VAR_SPECIAL%"
oper = ~"%OPERATORS%"

# ------------- EXPRESSION ------------- #

exprs_n = W? (exprs W?)+
exprs = w? (expr w?)+
expr = lamb / _expr1
_expr1 = group / str / oper / var_special / keyword / variable

keyword = py_keywords 
variable = (!oper !var_special !W ~"[^ğ—®-ğ˜‡â›ğš²â¥Œâ†¦â‘ â‘¡â‘¢â‘£ó°…‚\\\"\\' \\[\\](){}â…â†ã€šã€›âŸ¨âŸ©â€¹â€º]")+

group = (('(' exprs_n? ')') / ('{' exprs_n? '}')
      /  ('[' exprs_n? ']') / ('â…' exprs_n? 'â†')
      /  ('âŸ¨' exprs_n? 'âŸ©') / ('ã€š' exprs_n? 'ã€›'))

# --------------- LAMBDAS --------------- #

lamb_h_exprs_n = W? (lamb_h_expr W?)+
lamb_h_expr = (!lamb_h_implicit lamb) / _expr1

lamb_h_normal   = "â¥Œ" lamb_h_exprs_n "â†¦"
lamb_h_implicit = variable "â†¦"
lamb_h_preset   = ~"[ğš²â‘ â‘¡â‘¢â‘£]"
lamb_h = lamb_h_normal / lamb_h_implicit / lamb_h_preset
lamb_b = (exprs_n 'ó°…‚') / exprs
lamb = lamb_h lamb_b

# --------------- STRINGS --------------- #

str = special_str / py_str / str_escape / str_spec_char

special_str = ('â€¹' (str_escape / str_sub / str_spec_char / str_guts)* 'â€º')
str_sub = 'ã€š' exprs_n? 'ã€›'
str_guts = !str_spec_char ~"[^â›ã€šâ€º]+"
str_escape = ~"â›."
str_spec_char = ~"[ğ—®-ğ˜‡]"

py_str = (('"' (py_str_sub / ~"[^\\\\\"]+")* '"')
       /  ("'" (py_str_sub / ~"[^\\\\\']+")* "'"))
py_str_sub = ~"\\\\."

# whiespace
w = ~"[ \t]+"
W = ~"[ \t\n]+"
comment = ~"([î¬¦|#][^\\n]*(\\n|\\Z))|(ğŸŸ‘[^ğŸŸ‘]*(ğŸŸ‘|\\Z))|(Ö[^Ö]*(Ö|\\Z))"s