ó°‹º(â›ğ, *)
â¨¡ regex as re
â®Œ pickle â¨¡ loads, dumps

show_cache_table = â¥Œğ‘…,â„­â†¦â†¨â„­êŸ¿â¥Œi,vâ†¦â„µ(v)î ó°’¼â†’êŸ¿ó°²£â˜¾â€¹âŸ¦iâŸ§,âŸ¦xâŸ§ğ˜âŸ¦ğ‘…â‚“âŸ§ğ˜âŸ¦yâŸ§â€º

â®Œ time â¨¡ time
ğ“½_ = â–¡
âŠ¢ ğ“£(s=á¦):
    î¬¦ â†ª î¬¦ ó°¤±
    global ğ“½_
    Â¿ğ“½_â‰…â–¡:
        â€¹Starting timerâ€ºâ˜¾
        ğ“½_ = timeî®¦
        â†ª
    â€¹âŸ¦sâŸ§ took âŸ¦timeî®¦-ğ“½_âŸ§sâ€ºâ˜¾
    ğ“½_ = â–¡

ğŸŸ‘âŠ¢ parse(ğ·, ğ‘…, start_rule=â–¡):
    â„­, Ï‡ = ğ·ğŸƒŒ+1â†’â­¥á´ó°²¡{}, 0
    ğ“¢ = [(â–¡, ğ‘…ğŸƒŒ-1 Â¿start_ruleâ‰…â–¡Â¡ start_rule)]
    Ï‡ = 0
    â°ğ“¢:
        Î§, Î¹ = ğ“¢.pop(Â¯1)
        Â¿Î§â‰‡â–¡: Ï‡=Î§
        Î“ = Ï‡, Î¹
        Î³, â ¤ğ¶ = ğ‘…ó°ƒ¬
        ğ”  = â„­ó°ƒº
        match Î³:
            case â›á”:
                Â¿ğ¶â‚€â‰¡ğ·ó°ƒºï¹•ôŠ¸´ôŠ®ó°ƒºâ‚ŠôŠ³µôŠ¬£ôŠ¹³: ğ” ó°ƒ¬ = âœ“, ğŒ
                Â¡             : ğ” ó°ƒ¬ = âœ—, Ï‡
            case â›~:
                Â¿mâ‰”ğ¶â‚€.match(ğ·, Ï‡):
                    ğ” ó°ƒ¬ = âœ“, Ï‡ + m.group(0)ğŸƒŒ, m
                Â¡:  ğ” ó°ƒ¬ = âœ—, Ï‡
            case â›âˆ§:
                n, ğŒ = ğ” ó°ƒ¬ Â¿Î¹âˆˆğ” Â¡ (0, Ï‡)
                â°âœ“:
                    Â¿ğœ¾â‰”ğ¶â‚™ â†’âˆ‰â† ğ‘â‰”â„­ôŠ¸´:
                        ğ“¢.extend([Î“, (ğŒ, ğœ¾)])
                        ğ” ó°ƒ¬ = n, ğŒ ; â‡¥
                    ğ‘”, ğŒ = â„­ôŠ¸´ ôŠ¸§ ï¹•â‚‚
                    n += 1
                    Â¿    ğ‘”Â¬: ğ” ó°ƒ¬ = âœ—, Ï‡ ; â‡¥
                    Â¿n â‰¡ ğ¶ğŸƒŒ: ğ” ó°ƒ¬ = âœ“, ğŒ ; â‡¥
            case â›âˆ¨:
                n = ğ” ó°ƒ¬ Â¿Î¹âˆˆğ” Â¡ 0
                â°âœ“:
                    Â¿ğœ¾â‰”ğ¶â‚™ â†’âˆ‰â† ğ‘â‰”â„­ó°ƒº:
                        ğ“¢.extend([Î“, (Ï‡, ğœ¾)])
                        ğ” ó°ƒ¬ = n ; â‡¥
                    ğ‘”, ğŒ = â„­ó°ƒº ôŠ¸§ ï¹•â‚‚
                    Â¿    ğ‘” : ğ” ó°ƒ¬ = âœ“, ğŒ, n ; â‡¥
                    n += 1
                    Â¿n â‰¡ ğ¶ğŸƒŒ: ğ” ó°ƒ¬ = âœ—, Ï‡    ; â‡¥
            case â›*|â›+:
                c = ğ” .setdefault(Î¹, [Ï‡])
                ğœ¾, ğŒ = ğ¶â‚€, câ‚‹â‚
                â°âœ“:
                    Â¿ğœ¾ â†’âˆ‰â† ğ‘â‰”â„­ôŠ¸´:
                        ğ“¢.extend([Î“, (ğŒ, ğœ¾)])
                        â‡¥
                    ğ‘”, Î§ = â„­ôŠ¸´ ôŠ¸§ ï¹•â‚‚
                    Â¿Â¬ğ‘”:
                        Â¿Î³â‰¡â›* âˆ¨ cğŸƒŒ>1:
                            ğ” ó°ƒ¬ = âœ“, ğŒ, cï¹•â‚‹â‚
                        Â¡:
                            ğ” ó°ƒ¬ = âœ—, Ï‡
                        â‡¥
                    c.append(ğŒâ‰”Î§)
            case â›âœ“: ğ” ó°ƒ¬ = âœ“, Ï‡
            case â›âœ—: âœ—â¨³â€¹Hit an âœ—â€º
            case â›â†:
                Â¿ğ¶â‚âˆ‰ğ” :
                    ğ“¢.extend([Î“, (Ï‡, ğ¶â‚)])
                Â¡:
                    ğ‘”, ğŒ = ğ” ôŠ³µôŠ¬¤ ï¹•â‚‚
                    ğ” ó°ƒ¬ = ğ‘”, ğŒ, ğ¶â‚
            case _:
                Â¿ğ¶â‚€âˆ‰ğ” :
                    ğ“¢.extend([Î“, (Ï‡, ğ¶â‚€)])
                Â¡:
                    ğ‘”, ğŒ = ğ” ôŠ³µôŠ¬£ ï¹•â‚‚
                    match Î³:
                        case â›â®: ğ” ó°ƒ¬ = ğ‘” , Ï‡
                        case â›Â¬: ğ” ó°ƒ¬ = ğ‘”Â¬, Ï‡
                        case â›â—: ğ” ó°ƒ¬ = ğ‘”â¨³, ğŒ
                        case â›?: ğ” ó°ƒ¬ = âœ“ , ğŒ, ğ‘”
                        case  _: ğ” ó°ƒ¬ = ğ‘” , ğŒ
    â†ª â„­ğŸŸ‘

î¬¦ Optimized version
âŠ¢ parse(ğ·, ğ‘…, start_rule=â–¡):
    â„­, Ï‡ = ğ·ğŸƒŒ+1â†’â­¥á´ó°²¡{}, 0
    ğ“¢ = [(None, ğ‘…ğŸƒŒ-1 Â¿start_ruleâ‰…NoneÂ¡ start_rule)]
    Ï‡ = 0
    â°ğ“¢:
        Î§, Î¹ = ğ“¢.pop(Â¯1)
        Â¿Î§ is not None: Ï‡=Î§
        Î³, â ¤ğ¶ = ğ‘…ó°ƒ¬
        ğ”  = â„­ó°ƒº
        match Î³:
            case â›á”:
                Â¿ğ¶â‚€â‰¡ğ·ó°ƒºï¹•ôŠ¸´ôŠ®ó°ƒºâ‚Šâ‚—â‚‘â‚™â‚ôŠ³µôŠ¬£â‚: ğ” ó°ƒ¬ = âœ“, ğŒ
                Â¡                 : ğ” ó°ƒ¬ = âœ—, Ï‡
            case â›~:
                Â¿mâ‰”ğ¶â‚€.match(ğ·, Ï‡):
                    ğ” ó°ƒ¬ = âœ“, m.span()[1], m
                Â¡:  ğ” ó°ƒ¬ = âœ—, Ï‡
            case â›âˆ§:
                n, ğŒ = ğ” ó°ƒ¬ Â¿Î¹âˆˆğ” Â¡ (0, Ï‡)
                â°âœ“:
                    ğœ¾, ğ‘ = ğ¶â‚™, â„­ôŠ¸´
                    Â¿ğœ¾ not in ğ‘:
                        ğ“¢.extend([(Ï‡, Î¹), (ğŒ, ğœ¾)])
                        ğ” ó°ƒ¬ = n, ğŒ ; â‡¥
                    ğ‘”, ğŒ = â„­ôŠ¸´ ôŠ¸§ ï¹•â‚‚
                    n += 1
                    Â¿    not ğ‘” : ğ” ó°ƒ¬ = âœ—, Ï‡ ; â‡¥
                    Â¿n â‰¡ len(ğ¶): ğ” ó°ƒ¬ = âœ“, ğŒ ; â‡¥
            case â›âˆ¨:
                n = ğ” ó°ƒ¬ Â¿Î¹âˆˆğ” Â¡ 0
                â°âœ“:
                    ğœ¾, ğ‘ = ğ¶â‚™, â„­ó°ƒº
                    Â¿ğœ¾ not in ğ‘:
                        ğ“¢.extend([(Ï‡, Î¹), (Ï‡, ğœ¾)])
                        ğ” ó°ƒ¬ = n ; â‡¥
                    ğ‘”, ğŒ = â„­ó°ƒº ôŠ¸§ ï¹•â‚‚
                    Â¿ğ‘”: ğ” ó°ƒ¬ = âœ“, ğŒ, n ; â‡¥
                    n += 1
                    Â¿n â‰¡ len(ğ¶): ğ” ó°ƒ¬ = âœ—, Ï‡ ; â‡¥
            case â›*|â›+:
                Â¿Î¹âˆˆğ” : c = ğ” ó°ƒ¬
                Â¡   : c = ğ” ó°ƒ¬ = [Ï‡]
                ğœ¾, ğŒ = ğ¶â‚€, câ‚‹â‚
                â°âœ“:
                    ğ‘ = â„­ôŠ¸´
                    Â¿ğœ¾ not in ğ‘:
                        ğ“¢.extend([(Ï‡, Î¹), (ğŒ, ğœ¾)])
                        â‡¥
                    ğ‘”, Î§ = ğ‘ôŠ¸§ ï¹•â‚‚
                    Â¿Â¬ğ‘”:
                        Â¿Î³â‰¡â›* âˆ¨ len(c)>1:
                            ğ” ó°ƒ¬ = âœ“, ğŒ, cï¹•â‚‹â‚
                        Â¡:
                            ğ” ó°ƒ¬ = âœ—, Ï‡
                        â‡¥
                    c.append(ğŒâ‰”Î§)
            case â›âœ“: ğ” ó°ƒ¬ = âœ“, Ï‡
            case â›âœ—: assert âœ—, â¨³â€¹Hit an âœ—â€º
            case â›â†:
                Â¿ğ¶â‚âˆ‰ğ” :
                    ğ“¢.extend([(Ï‡, Î¹), (Ï‡, ğ¶â‚)])
                Â¡:
                    ğ‘”, ğŒ = ğ” ôŠ³µôŠ¬¤ ï¹•â‚‚
                    ğ” ó°ƒ¬ = ğ‘”, ğŒ, ğ¶â‚
            case _:
                Â¿ğ¶â‚€âˆ‰ğ” :
                    ğ“¢.extend([(Ï‡, Î¹), (Ï‡, ğ¶â‚€)])
                Â¡:
                    ğ‘”, ğŒ = ğ” ôŠ³µôŠ¬£ ï¹•â‚‚
                    match Î³:
                        case â›â®: ğ” ó°ƒ¬ =     ğ‘”, Ï‡
                        case â›Â¬: ğ” ó°ƒ¬ = not ğ‘”, Ï‡
                        case â›â—:
                            assert ğ‘”
                            ğ” ó°ƒ¬ = ğ‘”, ğŒ
                        case â›?: ğ” ó°ƒ¬ = âœ“, ğŒ, ğ‘”
                        case  _: ğ” ó°ƒ¬ = ğ‘”, ğŒ
    â†ª â„­

âŠ¢ make_rules(r):
    î¬¦ ó°¤± add option to skip jumping to declarations
    nmp = â„µ(râ»Î¶râ­¥)
    r = r êŸ¿á´· ó°²£â›_+x
    ğ‚ = â„µ(râ»Î¶ğ‘â‰”râ» á´ â›¶áµ€)
    âŠ¢ ğ•Š(r):
        Â¿rğŸƒŒâ‰¡1 âˆ§ râ‚€ â‚€â‰¡â›_: â†ª(râ‚€, )
        Â¿râˆˆğ‚: â†ª ğ‚áµ£
        Â¿râ‚€á¹ğ‘–: r = (ğ‘ôŠµ¬ôŠ®áµ£ôŠ¬£ â‚€, â ¤râ‚ï¹•)
        Â¡    : ğ‘.append(ğ”¦â‰”ğ‘ğŸƒŒ)
        Â¿râ‚€  â‰¡â›â†  : r = (râ‚€, râ‚, ğ•Š(râ‚‚))
        â¸˜râ‚€  âˆˆâ›âœ“â›âœ—: r = (râ‚€, ğ”¦)
        â¸˜râ‚€  âˆ‰â›á”â›~: r = (râ‚€, â ¤râ‚ï¹• á´ ğ•Š)
        î¬¦ ğ‘ôŠ³ôŠ¬ôŠ®ôŠµ¬â‰”r î¬¦ BROKEN ó°¤± FIX â˜¾
        ğ‘ôŠ³ôŠ¬ôŠ®ôŠµ¬=r
        â†ª ğ”¦
    ğ•Š(("T_root", â ¤nmpâºÎ¶râº á´ ğ‘¡))
    ğ‘ = ğ‘ á´ ó°²¡(xâ‚€, â ¤xâ‚ï¹• á´ó°²¡ (râ»ó°‘…á´µ(â‰¡ï(xâ‚€)))Â¿xá¹ğ‘¡Â¡x)
    â†ª â„µô‹†’|nmp
âŠ¢ parse_to_tree(ğ‘…, â„­, Ï‡, Î¹, show_table=âœ—, raise_failed=âœ“):
    î¬¦ rec = parse_to_treeï(ğ‘…, â„­, raise_failed=raise_failed)
    rec = ğš²parse_to_tree(ğ‘…, â„­, â ¤ğ”¸, raise_failed=raise_failed)
    Î³, â ¤C = ğ‘…ó°ƒ¬
    Â¿Î¹âˆ‰ğ” â‰”â„­ó°ƒº: â†ª Î³, â€¹â€¼âˆ„â€¼â€º
    ğ‘”, ğŒ, â ¤ğ´ = ğ” ó°ƒ¬
    Â¿raise_failed: ğ‘”â¨³â€¹Failed to parse tree!â€º
    
    Â¿Î³â‰¡â›âˆ§:
        o = []
        âˆ€râˆˆC:
            o.append(rec(Ï‡, r))
            Â¿râˆ‰ğ” â‰”â„­ó°ƒº: â‡¥
            Ï‡ = ğ” áµ£ â‚
        â†ª Î³, â ¤o
    Â¿Î³â‰¡â›á”: â†ª Î³, Câ‚€
    Â¿Î³â‰¡â›?: â†ª Î³, â ¤(ğ´ âˆ§ (ğ´â‚€ âˆ§ rec(Ï‡, Câ‚€)â›¶áµ€) âˆ¨ ())
    Â¿Â¬ğ´ âˆ§ Î³âˆˆ{â ¤"âˆ¨*+~â†"}: â†ª Î³, â€¹â€¼âˆ…â€¼â€º
    Â¿Î³â‰¡â›~: â†ª Î³, ğ´â‚€.group(0)
    Â¿Î³â‰¡â›âˆ¨: â†ª Î³, rec(Ï‡, CôŠ³³ôŠ¬£)
    Â¿Î³â‰¡â›â†: â†ª Î³, Câ‚€, rec(Ï‡, ğ´â‚€)
    î¬¦ Â¿Î³âˆˆ{â ¤"*+"}: â†ª Î³, â ¤ğ´â‚€ á´ recï(â¬¤, Câ‚€)
    Â¿Î³âˆˆ{â ¤"*+"}: â†ª Î³, â ¤(rec(x, Câ‚€) âˆ€xâˆˆğ´â‚€)
    Â¿Î³âˆˆ{â ¤"âœ“âœ—â®Â¬"}: â†ª Î³, 
    â†ª Î³.removeprefix(â›_), rec(Ï‡, Câ‚€)

âŠ¢ chop_tree(ó±•, ğ·, remove_trashes=âœ“,
             remove_failed_questions=âœ“,
             remove_lookaheads=âœ“):
    
    pops = â€¹âˆ§âˆ¨*+â—â ¶?â€º
    removes = ğ‘ (â›ó°†´â‹…remove_trashes+â›â®â›Â¬â‹…remove_lookaheads)
    
    âŠ¢ reform_str(ó±•):
        Â¿ó±•áµ—â‰¡â›á” âˆ¨ ó±•áµ—â‰¡â›~:
            ó±•áµ—, ó±•á¶œ, ó±•áµ‰ áµ€ = ó±•á¶œâ‚€áµ—, [], âœ“
        Â¡:
            âˆ€câˆˆó±•: reform_str(c)
        â†ª ó±•
    ğ“£î®¦ ; reform_str(ó±•) ; ğ“£("Reform_str")
    î¬¦ ó±•.ftrp(â›á”â›~, f)
    
    âŠ¢ Æ’(ó±•):
        Â¿ó±•áµ‰ áµ€: â†ª True
        Â¿ó±•áµ—âˆˆremoves: â†ª
        Â¿remove_failed_questions âˆ§ ó±•áµ—â‰¡â›?:
            Â¿Â¬ó±•á¶œ: â†ª
            ó±•á¶œ = list(filter(Æ’, ó±•á¶œ))
            Â¿Â¬ó±•á¶œ: â†ª
            â†ª True
        ó±•á¶œ = list(filter(Æ’, ó±•á¶œ))
        â†ª True
    ğ“£î®¦ ; Æ’(ó±•) ; ğ“£("Removes")
    î¬¦ Â¿removes:                 ó±• = Åƒ.filter(ó±•, ó°²¡xáµ‰ áµ€ âˆ¨ xáµ—âˆ‰removes)
    î¬¦ Â¿remove_failed_questions: ó±• = Åƒ.filter(ó±•, ó°²¡xáµ‰ áµ€ âˆ¨ xáµ—â‰ â›? âˆ¨ xá¶œ)
    
    âŠ¢ splat(ó±•):
        C = []
        âˆ€câˆˆó±•:
            Â¿cáµ‰ áµ€:
                C.append(c) ; â†º
            v = splat(c)
            Â¿isinstance(v, list):
                C.extend(v)
            â¸˜cáµ—âˆˆpops:
                C.extend(cá¶œ) ; â†º
            C.append(c)
        Â¿ó±•áµ—â‰¡â›â ¶: â†ªC
        ó±•á¶œ = C
    ğ“£î®¦ ; splat(ó±•) ; ğ“£("Splats")
    î¬¦ âŠ¢ splat(ó±•):
    î¬¦     Æ’ = ó°²¡(xá´ó°²¡xá¶œó°…‚Î£[]) Â¿xáµ—â‰¡â›â ¶Â¡ xá¶œ
    î¬¦     ó±•á¶œ = ó±• á´ó°²¡Æ’(x) Â¿xá¹Åƒâˆ§Â¬xáµ‰ áµ€âˆ§xáµ—âˆˆpopsÂ¡ xâ›¶ó°…‚ Î£[]
    î¬¦     â†ª ó±•
    î¬¦ ğ“£î®¦ ; ó±•.frp(ó°²¡Â¬xáµ‰ áµ€, splat, pre=âœ“) ; ğ“£("Splats")
    
    âŠ¢ get_txt(ó±•):
        Â¿ó±•áµ— â‰¡ â›Æ¨:
            l = ''
            âŠ¢ Æ’(ó±•):
                nonlocal l
                Â¿ó±•áµ‰ áµ€: l += ó±•áµ—
                âˆ€câˆˆó±• : Æ’(c)
            Æ’(ó±•)
            ó±•áµ—, ó±•á¶œ, ó±•áµ‰ = l, [], â„µ(T=âœ“)
            â†ª
        âˆ€câˆˆó±•: get_txt(c)
    ğ“£î®¦ ; get_txt(ó±•) ; ğ“£("Get_txt")
    î¬¦ ó±•.ftrp(â›Æ¨, ó°²¡Åƒ(get_txt(x), e=â„µ(T=âœ“)))
    
    âŠ¢ set_arrows(ó±•):
        Â¿ó±•áµ‰ áµ€: â†ª
        âˆ€i,c âˆˆ ó±•â†¨:
            Â¿cáµ‰ áµ€: â†º
            Â¿cáµ—â‰¡â›â†:
                ó±•áµ‰î ôŠ¬£ôŠ«¼ = ó±•áµ¢ = câ‚
            set_arrows(c)
    ğ“£î®¦ ; set_arrows(ó±•) ; ğ“£("Set arrows")
    â†ª ó±•

î¬¦ parse_to_node = ó±•â†¦(Æ’ â‰” ó°²¡Åƒ(x, â ¤ğ”¸á´ó°²¡Æ’(â ¤xÂ¿xá¹ğ‘¡Â¡xâ›¶áµ€)))(â ¤ó±•)
âŠ¢ parse_to_node(ó±•):
    âŠ¢ Æ’(x, â ¤ğ”¸):
        â†ª Åƒ(x, â ¤(Æ’(â ¤x Â¿isinstance(x,tuple)Â¡ (x,)) âˆ€xâˆˆğ”¸))
    â†ª Æ’(â ¤ó±•)

Î© Peggle2:
    __slots__ = â€¹rulesâ€‰Râ€ºâ­
    âŠ¢ __init__(ğ•Š, g): ğ•ŠÊ³áµ˜Ë¡áµ‰Ë¢, ğ•Šá´¿ = gÊ³áµ˜Ë¡áµ‰Ë¢â‹„gá´¿ Â¿gá¹Peggle2Â¡ gâ‹„make_rules(g)
    âŠ¢ __repr__(ğ•Š): â†ª â€¹âŸ¦á¹ğ•Šâ†’.__name__âŸ§[âŸ¦ğ•ŠÊ³áµ˜Ë¡áµ‰Ë¢ğŸƒŒâŸ§ Rules, âŸ¦ğ•Šá´¿ áµ€ô‹•ŸÊ³áµ’áµ’áµ—ğŸƒŒâŸ§ Normalized]â€º
    âŠ¢ __contains__(ğ•Š, x): â†ª xâˆˆğ•ŠÊ³áµ˜Ë¡áµ‰Ë¢
    âŠ¢ __or__(ğ•Š, h, allow_conflict=âœ—):
        Â¿há¹ğ•Š: h = hÊ³áµ˜Ë¡áµ‰Ë¢
        conflict = (ğ•ŠÊ³áµ˜Ë¡áµ‰Ë¢.keysî®¦)âˆ©(h.keysî®¦)
        Â¬(allow_conflict âˆ§ conflict)â¨³â€¹Conflicting rules! âŸ¦conflictâŸ§â€º
        â†ª (á¹ğ•Š)(Peggle2(ğ•ŠÊ³áµ˜Ë¡áµ‰Ë¢ | h))
    âŠ¢ __call__(ğ•Š, content, rule="main", DEBUG=âœ—, chop=âœ“, â ¶ğ“š):
        DEBUGÂ¬â¨³"Not implemented."
        c, r = content, rule
        root, rule = ğ•Šá´¿ áµ€ô‹•ŸÊ³áµ’áµ’áµ—, ğ•Šá´¿áµ£
        
        ğ“£î®¦ ; â„­ = parse(c, root, rule) ; ğ“£("Parse")
        
        ğ“£î®¦ ; ó±• = parse_to_tree(root, â„­, 0, rule) ; ğ“£("Convert")
        
        ğ“£î®¦ ; ó±• = parse_to_node(ó±•) ; ğ“£("Nodeing")
        
        ğ’¸ = ğš²chop_tree(ó±•, c, â ¶ğ“š|ğ•‚)
        â†ª ğ’¸î®¦ Â¿chopÂ¡ â„µ(table=â„­, tree=ó±•, chop=ğ’¸)
    âŠ¢ print_rules(ğ•Š):
        ğ•ŠÊ³áµ˜Ë¡áµ‰Ë¢.itemsî®¦êŸ¿ó°²£(â€¹âŸ¦xâŸ§:â€ºâ˜¾, yâ˜¾)
    âŠ¢ print_normalized(ğ•Š):
        ğ•Šá´¿ áµ€ô‹•ŸÊ³áµ’áµ’áµ—â†¨ êŸ¿ó°²£ â˜¾â€¹âŸ¦xâŸ§ğ˜âŸ¦ğ˜€.join(yá´á”)âŸ§â€º

GRANDMA_RULES = Å•â‰”(â ¤map(re.compile, (('[\ueb26#][^\\n]*'), ('[â¯…â¯†â–³â–½â†·]'), ('"(â›.|[^"])*"'), ("'(â›.|[^'])*'"), ('â€¹(â›.|[^â€º])*â€º'), ('[^â¯…â¯†â–³â–½â†·ó°†´()?â—â®.:â ¶Æ¨âœ—+*=Â¬âˆ¨âˆ§~â€¹#î¬¦\'" \\t\\n]+|âœ—'), ('[ó°†´â—â®â ¶Æ¨~Â¬]'), ('[*+?]'), ('([ \\t]|â›\\n)+'), ('([ \\t\\n]|â›\\n)+'))),) â†’â–ºâ† â„µâˆ˜{'statements':('âˆ¨',('âˆ§',('?',('_W',)),('*',('âˆ§',('âˆ¨',('_comment',),('_elm_o',)),('?',('_W',)))))),'comment':('âˆ¨',('~',Å•[0])),'elm_o':('âˆ¨',('âˆ§',('_elm_a',),('*',('âˆ§',('?',('_W',)),('á”','âˆ¨'),('?',('_W',)),('_elm_a',))))),'elm_a':('âˆ¨',('âˆ§',('_elm_j',),('*',('âˆ§',('âˆ¨',('âˆ§',('?',('_W',)),('á”','âˆ§'),('?',('_W',))),('?',('_w',))),('_elm_j',))))),'elm_j':('âˆ¨',('__elm_j',),('_elm',)),'_elm_j':('âˆ¨',('âˆ§',('_elm',),('?',('_W',)),('~',Å•[1]),('?',('_W',)),('âˆ¨',('__elm_j',),('_elm',)))),'elm':('âˆ¨',('âˆ§',('_prefix',),('âˆ¨',('_assign_eql',),('_assign_cln',),('_group',),('_str',),('_rname',)),('_suffix',))),'assign_eql':('âˆ¨',('âˆ§',('_rname',),('?',('_W',)),('á”','='),('?',('_W',)),('_elm_o',))),'assign_cln':('âˆ¨',('âˆ§',('_rname',),('?',('_W',)),('á”',':'),('?',('_W',)),('_elm_j',))),'group':('âˆ¨',('âˆ§',('á”','('),('?',('_W',)),('_group_inner',),('á”',')'))),'group_inner':('âˆ¨',('*',('âˆ§',('_elm_o',),('?',('_W',))))),'str1':('âˆ¨',('~',Å•[2])),'str2':('âˆ¨',('~',Å•[3])),'str3':('âˆ¨',('~',Å•[4])),'str':('âˆ¨',('_str1',),('_str2',),('_str3',)),'rname':('âˆ¨',('~',Å•[5])),'prefix':('âˆ¨',('âˆ§',('?',('_w',)),('+',('âˆ§',('~',Å•[6]),('?',('_W',))))),('?',('_w',))),'suffix':('âˆ¨',('âˆ§',('+',('âˆ§',('?',('_W',)),('~',Å•[7]))),('?',('_w',))),('?',('_w',))),'w':('âˆ¨',('~',Å•[8])),'W':('âˆ¨',('~',Å•[9]))}
BOOTSTRAP = Peggle2(GRANDMA_RULES)

__exports__ = "Peggle2",

Â¿ __name__â‰¡"__main__":
    RULE = "statements"
    CONTENT = ó°¦¥ó°¦¥ó°¦¥ó°¦¥ó°¦¥
    main    = ó°†´W? (entry ó°†´W?)*
    entry   = (
        Æ¨(section=ó°†´'[' wrd ó°†´']') ó°†´W?
        (pair = (
            (bruh:key = â ¶wrd) ó°†´(w? â†· '=')
            (value = (wrd âˆ¨ str)+) ó°†´W? ) )* )
    str     = ~â€¹"[^"]+"â€º
    wrd     = ~â€¹[-\w]+â€º
    w       = ~â€¹[ \t]+â€º
    W       = ~â€¹[ \t\n]+â€º
    ó°¦¥ó°¦¥ó°¦¥ó°¦¥ó°¦¥â‹…2

    BOOTSTRAPâ˜¾
    ó±• = BOOTSTRAP(CONTENT, RULE)
    "FINISHED"â˜¾
    ó±•á´¾î®¦â˜¾

âŠ¢ Peggle1Bootstrap(c=â„µ()):
    Â¿"BOOTSTRAP_PEGGLE1"âˆˆc:
        â†ª c.ForcefeedPeggle1Peggle2, c.BOOTSTRAP_PEGGLE1
    
    âŠ¢ peggle122(rules):
        âŠ¢ Æ’(x):
            Â¿xáµ—â‰¡â›â†: â†ª (xáµ—, xâ‚€á¶œ, Æ’(xâ‚))
            Â¿xáµ—â‰¡"rname": â†ª (â›_â‹…(xá¶œâˆ‰â›âœ“â›âœ—)+xá¶œ, )
            â†ª xáµ—, â ¤((xá¶œ á´ Æ’) Â¿xá´¸Â¡ (xá¶œ, ))
        â†ª â„µ(rules) êŸ¿â±½ ó°²£Æ’(y)
    âŠ¢ peggle221(ó±•):
        â®Œ node â¨¡ Node
        âŠ¢ Æ’(ó±•):
            s = â„µ()
            âˆ€k,v âˆˆ ó±•áµ‰:
                Â¿kâ‰¡â›T: â†ªNode(c=ó±•áµ—)
                sô‹‘ºôŠ¬„ô‹•œáµ¢â‚™î â‚‘â‚“â‚áµ¥â‚ = k
            c = ó±•á´Æ’
            âˆ€i,vâˆˆs: cáµ¢áµ‰ = v
            â†ªNode(ó±•áµ—, c)
        â†ª Æ’(ó±•).find_replace(ó°²¡xğŸƒŒâ‰¡1 âˆ§ xá¶œâ‚€á¹Node âˆ§ Â¬xá¶œâ‚€áµ—, ó°²¡x.copy(c=xáµ—Ë£áµ—))

    Î© ForcefeedPeggle1Peggle2(Peggle2):
        âŠ¢ __init__(ğ•Š, x):
            Â¿xá¹Peggle2: super().__init__(x)
            Â¡         : super().__init__(peggle122(x))
        âŠ¢ __call__(ğ•Š, â ¤ğ”¸, â ¶ğ•‚):
            â†ª peggle221(super().__call__(â ¤ğ”¸, â ¶ğ•‚))
        âŠ¢ __or__(ğ•Š, x):
            â†ª super().__or__(peggle122(x))
        âŠ¢ dump_gram(ğ•Š):
            â†ª dumps((ğ‘‘âˆ˜ğ•ŠÊ³áµ˜Ë¡áµ‰Ë¢, ğ‘‘âˆ˜ğ•Šá´¿, ğ•Šá´¿.getdefî®¦))
        @ğ’â„³
        âŠ¢ load_gram(â„‚, gram):
            ğ•Š = â„‚.__new__(â„‚)
            rules, R, d = loads(gram)
            ğ•ŠÊ³áµ˜Ë¡áµ‰Ë¢, ğ•Šá´¿ = â„µ(rules), â„µáµˆ(R)
            â†ª ğ•Š

    c.ForcefeedPeggle1Peggle2 = ForcefeedPeggle1Peggle2
    c.BOOTSTRAP_PEGGLE1 = ForcefeedPeggle1Peggle2(BOOTSTRAP)
    â†ª c.ForcefeedPeggle1Peggle2, c.BOOTSTRAP_PEGGLE1