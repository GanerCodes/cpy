ó°‹º(â›ğ, *)
try             : â¨¡ regex as re
except Exception: â¨¡ re
â®Œ pickle â¨¡ loads, dumps

show_cache_table = â¥Œğ‘…,â„­â†¦â†¨â„­êŸ¿â¥Œi,vâ†¦â„µ(v)î ó°’¼â†’êŸ¿ó°²£â˜¾â€¹âŸ¦iâŸ§,âŸ¦xâŸ§ğ˜âŸ¦ğ‘…â‚“âŸ§ğ˜âŸ¦yâŸ§â€º

â®Œ time â¨¡ time
ğ“½_ = â–¡
âŠ¢ ğ“£(s=á¦):
    î¬¦ â†ª î¬¦ ó°¤±
    global ğ“½_
    Â¿ğ“½_â‰…â–¡:
        â€¹Starting timerâ€ºâ˜¾
        ğ“½_ = timeî®¦
        â†ª
    â€¹âŸ¦sâŸ§ took âŸ¦timeî®¦-ğ“½_âŸ§sâ€ºâ˜¾
    ğ“½_ = â–¡

âŠ¢ gram_convert(ó±•):
    name_remaps = â„µ("elm_oâ€‰elm_aâ€‰assign_clnâ€‰group_innerâ€‰group"â­ó±‘¼"âˆ¨âˆ§â†âˆ§âˆ§")
    Æ = â„µ(T=âœ“)
    TT = ó±•â†¦(ó±•áµ—, â ¤(ó±•áµ—âˆˆâ›á”â›~ â­œ(ó±•â‚€áµ—,)â­ ó±•áµ—â‰¡â›â† â­œ(ó±•â‚€áµ—, â ¤ó±•â‚ï¹•á´TT)â­ ó±•á´TT))
    escape = â¥Œx,t=â›İºâ†¦x.replace(â›â›â›â›, t).replace(â›â›, '').replace(t, â›â›)
    txt = ó°²¡Åƒ(x, e=Æ)
    âŠ¢ reduce_j(ó±•):
        Î±, o, Î², â ¤C = ó±•
        Â¿C: âœ—â¨³ î¬¦ Î² = reduce_j(ó±•.cp(c=[Î², â ¤C])) î¬¦ ????????
        Â¿oáµ—â‰¡â›â†·: â†ª Åƒ(â›âˆ§, Î±, Î², Î±)
        â¸˜oáµ—â‰¡â›â¯†: â†ª Åƒ(â›âˆ¨, Åƒ(â›âˆ§, Î², Åƒ(â›+, Åƒ(â›âˆ§, Î±, Î²))), Î²)
        â¸˜oáµ—â‰¡â›â–³: â†ª Åƒ(â›âˆ¨, Åƒ(â›âˆ§, Åƒ(â›*, Åƒ(â›âˆ§, Î±, Î²)), Î±), Î±)
        â¸˜oáµ—â‰¡â›â–½: â†ª Åƒ(â›âˆ¨, Åƒ(â›âˆ§, Åƒ(â›âˆ§, Î², Åƒ(â›*, Åƒ(â›âˆ§, Î±, Î²)))), Åƒ(â›âœ“, ))
        â¸˜oáµ—â‰¡â›â¯…: â†ª Åƒ(â›âˆ§, Åƒ(â›+, Åƒ(â›âˆ§, Î±, Î²)), Î±)
        âœ—â¨³
    âŠ¢ bad(ó±•):
        Â¿ó±•áµ—âˆˆ"commentâ€‰wâ€‰W"â­: â†ªâœ“
        Â¿Â¬ó±•áµ—âˆ§ó±•ğŸƒŒâ‰¡1âˆ§ó±•á¶œâ‚€áµ‰ áµ€âˆ§ó±•á¶œâ‚€áµ—âˆˆâ€¹()âˆ§âˆ¨:=â€º: â†ªâœ“
    âŠ¢ collapse_ao(ó±•):
        Â¿ó±•áµ‰ áµ€: â†ªó±•
        ó±•á¶œ = ó±•á¶œ á´ó°²¡xá¶œ Â¿(xâ‰”collapse_ao(x))áµ—â‰¡ó±•áµ—âˆˆâ›âˆ§â›âˆ¨Â¡ [x]ó°…‚ â¨[]
        â†ª ó±•
    âŠ¢ parse_elm(N):
        Î±, n, Î² = Nâ‚€.as_txt(), Nâ‚, Nâ‚‚.as_txt()
        l1, l2 = Î± î®†á´® â€¹â—â ¶Æ¨â€º.__contains__
        âˆ€o âˆˆ (â ¤l1, â ¤Î², â ¤l2):
            Â¿oâ‰¡â›~: n = Åƒ(o, Åƒ(re.compile(n.as_txt()), e=Æ))
            Â¡    : n = Åƒ(o, n)
        â†ªn
    
    rules = ó±•.rm  (bad) â›
             .ftrp("prefixâ€‰suffix"â­, ó°²¡Åƒ(xáµ—, txt(x.as_txt()))) â›
             .ftrp(          "str"â­, ó°²¡Åƒ(â›á”, txt(escape(x.as_txt()â‚ï¹•ô¨„)))) â›
             .ftrp(    name_remapsâ», ó°²¡Åƒ(name_remapsâ‚“ôŠ«¼, â ¤(yâˆ€yâˆˆxÂ¿Â¬yáµ‰ áµ€)), âœ“) â›
             .flat(ó°²¡xáµ—â‰¡"_elm_j") â›
             .find(ó°²¡xáµ—â‰¡"assign_eql")
    rules = â„µ(rules á´ ó°²¡(xâ‚€.as_txt(),xâ‚‚))
    
    âˆ€k,ó±•âˆˆrules:
        ó±• = collapse_ao(
                ó±•.ftrp("assign_eql"â­, ó°²¡xâ‚€, âœ“) â›
                 .flat(ó°²¡xáµ—âˆˆ"âˆ§â€‰âˆ¨â€‰elm_j"â­âˆ§xğŸƒŒâ‰¡1)) â›
            .ftrp("elm_j"â­,  reduce_j, âœ“) â›
            .ftrp(  "elm"â­, parse_elm, âœ“) â›
            .ftrp(     â›â†â­, ó°²¡Åƒ(xáµ—, txt(xâ‚€ â‚€áµ—), â ¤xâ‚ï¹•), âœ“) â›
            .ftrp("rname"â­, ó°²¡Åƒ(â›_â‹…(xâ‚€áµ—âˆ‰â›âœ“â›âœ—)+xâ‚€áµ—, e=Æ))
        Â¿ó±•áµ—âˆˆâ›âˆ§â›âˆ¨ âˆ§ ó±•ğŸƒŒâ‰¡1: ó±•=ó±•â‚€
        rulesâ‚– = TT(ó±•)
        
    â†ª rules

î¬¦ Hard to read âˆµ very optimized
âŠ¢ parse(ğ·, ğ‘…, start_rule=â–¡):
    â„­, Ï‡ = ğ·ğŸƒŒ+1â†’â­¥á´ó°²¡{}, 0
    ğ“¢ = [(None, ğ‘…ğŸƒŒ-1 Â¿start_ruleâ‰…â–¡Â¡ start_rule)]
    Ï‡ = 0
    â°ğ“¢:
        Î§, Î¹ = ğ“¢.pop(ó·°¾)
        Â¿Î§ is not None: Ï‡=Î§
        Î³, â ¤ğ¶ = ğ‘…ó°ƒ¬
        ğ”  = â„­ó°ƒº
        Â¿Î³â‰¡â›á”:
            Â¿ğ¶â‚€â‰¡ğ·ó°ƒºï¹•ôŠ¸´ôŠ®ó°ƒºâ‚Šâ‚—â‚‘â‚™â‚ôŠ³µôŠ¬£â‚: ğ” ó°ƒ¬ = âœ“, ğŒ
            Â¡                 : ğ” ó°ƒ¬ = âœ—, Ï‡
        â¸˜Î³â‰¡â›~:
            Â¿mâ‰”ğ¶â‚€.match(ğ·, Ï‡):
                ğ” ó°ƒ¬ = âœ“, m.span()â‚, m
            Â¡:  ğ” ó°ƒ¬ = âœ—, Ï‡
        â¸˜Î³â‰¡â›âˆ§:
            n, ğŒ = ğ” ó°ƒ¬ Â¿Î¹âˆˆğ” Â¡ (0, Ï‡)
            â°âœ“:
                ğœ¾, ğ‘ = ğ¶â‚™, â„­ôŠ¸´
                Â¿ğœ¾ âˆ‰ ğ‘:
                    ğ“¢.extend([(Ï‡, Î¹), (ğŒ, ğœ¾)])
                    ğ” ó°ƒ¬ = n, ğŒ ; â‡¥
                ğ‘”, ğŒ = â„­ôŠ¸´ ôŠ¸§ ï¹•â‚‚
                n += 1
                Â¿    not ğ‘” : ğ” ó°ƒ¬ = âœ—, Ï‡ ; â‡¥
                Â¿n â‰¡ len(ğ¶): ğ” ó°ƒ¬ = âœ“, ğŒ ; â‡¥
        â¸˜Î³â‰¡â›âˆ¨:
            n = ğ” ó°ƒ¬ Â¿Î¹âˆˆğ” Â¡ 0
            â°âœ“:
                ğœ¾, ğ‘ = ğ¶â‚™, â„­ó°ƒº
                Â¿ğœ¾ âˆ‰ ğ‘:
                    ğ“¢.extend([(Ï‡, Î¹), (Ï‡, ğœ¾)])
                    ğ” ó°ƒ¬ = n ; â‡¥
                ğ‘”, ğŒ = â„­ó°ƒº ôŠ¸§ ï¹•â‚‚
                Â¿ğ‘”: ğ” ó°ƒ¬ = âœ“, ğŒ, n ; â‡¥
                n += 1
                Â¿n â‰¡ len(ğ¶): ğ” ó°ƒ¬ = âœ—, Ï‡ ; â‡¥
        â¸˜Î³â‰¡â›* âˆ¨ Î³â‰¡â›+:
            Â¿Î¹âˆˆğ” : c = ğ” ó°ƒ¬
            Â¡   : c = ğ” ó°ƒ¬ = [Ï‡]
            ğœ¾, ğŒ = ğ¶â‚€, cô¨„
            â°âœ“:
                ğ‘ = â„­ôŠ¸´
                Â¿ğœ¾ not in ğ‘:
                    ğ“¢.extend([(Ï‡, Î¹), (ğŒ, ğœ¾)])
                    â‡¥
                ğ‘”, Î§ = ğ‘ôŠ¸§ ï¹•â‚‚
                Â¿Â¬ğ‘”:
                    Â¿Î³â‰¡â›* âˆ¨ len(c)>1:
                        ğ” ó°ƒ¬ = âœ“, ğŒ, cï¹•â‚‹â‚
                    Â¡:
                        ğ” ó°ƒ¬ = âœ—, Ï‡
                    â‡¥
                c.append(ğŒâ‰”Î§)
        â¸˜Î³â‰¡â›âœ“: ğ” ó°ƒ¬ = âœ“, Ï‡
        â¸˜Î³â‰¡â›âœ—: assert âœ—, â¨³â€¹Hit an âœ—â€º
        â¸˜Î³â‰¡â›â†:
            Â¿ğ¶â‚âˆ‰ğ” :
                ğ“¢.extend([(Ï‡, Î¹), (Ï‡, ğ¶â‚)])
            Â¡:
                ğ‘”, ğŒ = ğ” ôŠ³µôŠ¬¤ ï¹•â‚‚
                ğ” ó°ƒ¬ = ğ‘”, ğŒ, ğ¶â‚
        â¸˜ğ¶â‚€âˆ‰ğ” :
            ğ“¢.extend([(Ï‡, Î¹), (Ï‡, ğ¶â‚€)])
        Â¡:
            ğ‘”, ğŒ = ğ” ôŠ³µôŠ¬£ ï¹•â‚‚
            Â¿Î³â‰¡â›â®: ğ” ó°ƒ¬ =     ğ‘”, Ï‡
            â¸˜Î³â‰¡â›Â¬: ğ” ó°ƒ¬ = not ğ‘”, Ï‡
            â¸˜Î³â‰¡â›â—:
                assert ğ‘”
                ğ” ó°ƒ¬ = ğ‘”, ğŒ
            â¸˜Î³â‰¡â›?: ğ” ó°ƒ¬ = âœ“, ğŒ, ğ‘”
            Â¡    : ğ” ó°ƒ¬ = ğ‘”, ğŒ
    â†ª â„­

âŠ¢ make_rules(r):
    î¬¦ ó°¤± add option to skip jumping to declarations
    nmp = â„µ(râ»ó±‘¼râ­¥)
    r = r êŸ¿á´· ó°²£â›_+x
    ğ‚ = â„µ(râ»ó±‘¼ğ‘â‰”râ» á´ â›¶áµ€)
    âŠ¢ ğ•Š(r):
        Â¿rğŸƒŒâ‰¡1 âˆ§ râ‚€ â‚€â‰¡â›_: â†ª(râ‚€, )
        Â¿râˆˆğ‚: â†ª ğ‚áµ£
        Â¿râ‚€á¹ğ‘–: r = (ğ‘ôŠµ¬ôŠ®áµ£ôŠ¬£ â‚€, â ¤râ‚ï¹•)
        Â¡    : ğ‘.append(ğ”¦â‰”ğ‘ğŸƒŒ)
        Â¿râ‚€  â‰¡â›â†  : r = (râ‚€, râ‚, ğ•Š(râ‚‚))
        â¸˜râ‚€  âˆˆâ›âœ“â›âœ—: r = (râ‚€, ğ”¦)
        â¸˜râ‚€  âˆ‰â›á”â›~: r = (râ‚€, â ¤râ‚ï¹• á´ ğ•Š)
        â†ª ğ‘ôŠ³ôŠ¬ôŠ®ôŠµ¬â‰”r â†’â–º ğ”¦
    ğ•Š(("T_root", â ¤nmpâºó±‘¼râº á´ ğ‘¡))
    ğ‘ = ğ‘ á´ ó°²¡(xâ‚€, â ¤xâ‚ï¹• á´ó°²¡ (râ»ó°‘…á´µ(â‰¡ï(xâ‚€)))Â¿xá¹ğ‘¡Â¡x)
    â†ª â„µô‹†’|nmp
âŠ¢ parse_to_tree(ğ‘…, â„­, Ï‡, Î¹, show_table=âœ—, raise_failed=âœ“):
    rec = ğš²parse_to_tree(ğ‘…, â„­, â ¤ğ”¸, raise_failed=raise_failed)
    Î³, â ¤C = ğ‘…ó°ƒ¬
    Â¿Î¹âˆ‰ğ” â‰”â„­ó°ƒº: â†ª Î³, â€¹â€¼âˆ„â€¼â€º
    ğ‘”, ğŒ, â ¤ğ´ = ğ” ó°ƒ¬
    Â¿raise_failed: ğ‘”â¨³â€¹Failed to parse tree!â€º
    
    Â¿Î³â‰¡â›âˆ§:
        o = []
        âˆ€râˆˆC:
            o.append(rec(Ï‡, r))
            Â¿râˆ‰ğ” â‰”â„­ó°ƒº: â‡¥
            Ï‡ = ğ” áµ£ â‚
        â†ª Î³, â ¤o
    Â¿Î³â‰¡â›á”: â†ª Î³, Câ‚€
    Â¿Î³â‰¡â›?: â†ª Î³, â ¤(ğ´ âˆ§ (ğ´â‚€ âˆ§ rec(Ï‡, Câ‚€)â›¶áµ€) âˆ¨ ())
    Â¿Â¬ğ´ âˆ§ Î³âˆˆ{â ¤"âˆ¨*+~â†"}: â†ª Î³, â€¹â€¼âˆ…â€¼â€º
    Â¿Î³â‰¡â›~: â†ª Î³, ğ´â‚€.group(0)
    Â¿Î³â‰¡â›âˆ¨: â†ª Î³, rec(Ï‡, CôŠ³³ôŠ¬£)
    Â¿Î³â‰¡â›â†: â†ª Î³, Câ‚€, rec(Ï‡, ğ´â‚€)
    î¬¦ Â¿Î³âˆˆ{â ¤"*+"}: â†ª Î³, â ¤ğ´â‚€ á´ recï(â¬¤, Câ‚€)
    Â¿Î³âˆˆ{â ¤"*+"}: â†ª Î³, â ¤(rec(x, Câ‚€) âˆ€xâˆˆğ´â‚€)
    Â¿Î³âˆˆ{â ¤"âœ“âœ—â®Â¬"}: â†ª Î³, 
    â†ª Î³.removeprefix(â›_), rec(Ï‡, Câ‚€)

âŠ¢ chop_tree(ó±•, ğ·, remove_trashes=âœ“,
             remove_failed_questions=âœ“,
             remove_lookaheads=âœ“,
             DEBUG=âœ—):
    â„’ = ğ“£ Â¿DEBUGÂ¡ â´´
    
    pops = â€¹âˆ§âˆ¨*+â—â ¶?â€º
    removes = ğ‘ (â›ó°†´â‹…remove_trashes+â›â®â›Â¬â‹…remove_lookaheads)
    
    âŠ¢ reform_str(ó±•):
        Â¿ó±•áµ—â‰¡â›á” âˆ¨ ó±•áµ—â‰¡â›~:
            ó±•áµ—, ó±•á¶œ, ó±•áµ‰ áµ€ = ó±•á¶œâ‚€áµ—, [], âœ“
        Â¡:
            âˆ€câˆˆó±•: reform_str(c)
        â†ª ó±•
    â„’î®¦ ; reform_str(ó±•) ; â„’("Reform_str")
    î¬¦ ó±•.ftrp(â›á”â›~, f)
    
    âŠ¢ Æ’(ó±•):
        Â¿ó±•áµ‰ áµ€: â†ª True
        Â¿ó±•áµ—âˆˆremoves: â†ª
        Â¿remove_failed_questions âˆ§ ó±•áµ—â‰¡â›?:
            Â¿Â¬ó±•á¶œ: â†ª
            ó±•á¶œ = [â ¤filter(Æ’, ó±•á¶œ)]
            Â¿Â¬ó±•á¶œ: â†ª
            â†ª True
        ó±•á¶œ = [â ¤filter(Æ’, ó±•á¶œ)]
        â†ª True
    â„’î®¦ ; Æ’(ó±•) ; â„’("Removes")
    î¬¦ Â¿removes:                 ó±• = Åƒ.filter(ó±•, ó°²¡xáµ‰ áµ€ âˆ¨ xáµ—âˆ‰removes)
    î¬¦ Â¿remove_failed_questions: ó±• = Åƒ.filter(ó±•, ó°²¡xáµ‰ áµ€ âˆ¨ xáµ—â‰ â›? âˆ¨ xá¶œ)
    
    âŠ¢ splat(ó±•):
        C = []
        âˆ€câˆˆó±•:
            Â¿cáµ‰ áµ€:
                C.append(c) ; â†º
            v = splat(c)
            Â¿isinstance(v, list):
                C.extend(v)
            â¸˜cáµ—âˆˆpops:
                Â¿cáµ—â‰¡â›â ¶:
                    âˆ€lâˆˆc:
                        C.extend(lá¶œ)
                Â¡:
                    C.extend(cá¶œ)
            Â¡:
                C.append(c)
        ó±•á¶œ = C
    â„’î®¦ ; splat(ó±•) ; â„’("Splats")
    
    î¬¦ âŠ¢ splat(ó±•):
    î¬¦     Æ’ = ó°²¡(xá´ó°²¡xá¶œó°…‚â¨[]) Â¿xáµ—â‰¡â›â ¶Â¡ xá¶œ
    î¬¦     ó±•á¶œ = ó±• á´ó°²¡Æ’(x) Â¿xá¹Åƒâˆ§Â¬xáµ‰ áµ€âˆ§xáµ—âˆˆpopsÂ¡ xâ›¶ó°…‚ â¨[]
    î¬¦     â†ª ó±•
    î¬¦ â„’î®¦ ; ó±•.frp(ó°²¡Â¬xáµ‰ áµ€, splat, pre=âœ“) ; â„’("Splats")
    
    âŠ¢ get_txt(ó±•):
        Â¿ó±•áµ— â‰¡ â›Æ¨:
            l = ''
            âŠ¢ Æ’(ó±•):
                nonlocal l
                Â¿ó±•áµ‰ áµ€:
                    l += ó±•áµ—
                Â¡:
                    âˆ€câˆˆó±•: Æ’(c)
            Æ’(ó±•)
            ó±•áµ—, ó±•á¶œ, ó±•áµ‰ = l, [], â„µ(T=âœ“)
            â†ª
        âˆ€câˆˆó±•: get_txt(c)
    â„’î®¦ ; get_txt(ó±•) ; â„’("Get_txt")
    î¬¦ ó±•.ftrp(â›Æ¨, ó°²¡Åƒ(get_txt(x), e=â„µ(T=âœ“)))
    
    âŠ¢ set_arrows(ó±•):
        Â¿ó±•áµ‰ áµ€: â†ª
        âˆ€i,c âˆˆ ó±•â†¨:
            Â¿cáµ‰ áµ€: â†º
            Â¿cáµ—â‰¡â›â†:
                ó±•áµ‰î ôŠ¬£ôŠ«¼ = ó±•áµ¢ = câ‚
            set_arrows(c)
    â„’î®¦ ; set_arrows(ó±•) ; â„’("Set arrows")
    â†ª ó±•

î¬¦ parse_to_node = ó±•â†¦(Æ’ â‰” ó°²¡Åƒ(x, â ¤ğ”¸á´ó°²¡Æ’(â ¤xÂ¿xá¹ğ‘¡Â¡xâ›¶áµ€)))(â ¤ó±•)
âŠ¢ parse_to_node(ó±•):
    âŠ¢ Æ’(x, â ¤ğ”¸):
        â†ª Åƒ(x, â ¤(Æ’(â ¤x Â¿isinstance(x,tuple)Â¡ (x,)) âˆ€xâˆˆğ”¸))
    â†ª Æ’(â ¤ó±•)

ó±€˜ peggle2:
    __slots__ = â€¹rulesâ€‰Râ€ºâ­
    âŠ¢ __init__(ğ•Š, g):
        Â¿gá¹á”: g = FROM_GRAM(g)
        ğ•ŠÊ³áµ˜Ë¡áµ‰Ë¢, ğ•Šá´¿ = gÊ³áµ˜Ë¡áµ‰Ë¢â‹„gá´¿ Â¿gá¹peggle2Â¡ gâ‹„make_rules(g)
    âŠ¢ __repr__(ğ•Š): â†ª â€¹âŸ¦á¹ğ•Šâ†’.__name__âŸ§[âŸ¦ğ•ŠÊ³áµ˜Ë¡áµ‰Ë¢ğŸƒŒâŸ§ Rules, âŸ¦ğ•Šá´¿ áµ€ô‹•ŸÊ³áµ’áµ’áµ—ğŸƒŒâŸ§ Normalized]â€º
    âŠ¢ __contains__(ğ•Š, x): â†ª xâˆˆğ•ŠÊ³áµ˜Ë¡áµ‰Ë¢
    âŠ¢ __or__(ğ•Š, h, allow_conflict=âœ—):
        Â¿há¹ğ•Š: h = hÊ³áµ˜Ë¡áµ‰Ë¢
        conflict = (ğ•ŠÊ³áµ˜Ë¡áµ‰Ë¢.keysî®¦)âˆ©(h.keysî®¦)
        Â¬(allow_conflict âˆ§ conflict)â¨³â€¹Conflicting rules! âŸ¦conflictâŸ§â€º
        â†ª (á¹ğ•Š)(peggle2(ğ•ŠÊ³áµ˜Ë¡áµ‰Ë¢ | h))
    âŠ¢ __call__(ğ•Š, content, rule="main", DEBUG=âœ—, chop=âœ“, â ¶ğ“š):
        c, r = content, rule
        root, rule = ğ•Šá´¿ áµ€ô‹•ŸÊ³áµ’áµ’áµ—, ğ•Šá´¿áµ£
        
        â„’ = ğ“£ Â¿DEBUGÂ¡ â´´
        â„’î®¦ ; â„­ = parse(c, root, rule)            ; â„’("Parse")
        â„’î®¦ ; ó±• = parse_to_tree(root, â„­, 0, rule) ; â„’("Convert")
        â„’î®¦ ; ó±• = parse_to_node(ó±•)                ; â„’("Nodeing")
        
        ğ’¸ = ğš²chop_tree(ó±•, c, DEBUG=DEBUG, â ¶ğ“š|ğ•‚)
        â†ª ğ’¸î®¦ Â¿chopÂ¡ â„µ(table=â„­, tree=ó±•, chop=ğ’¸)
    âŠ¢ print_rules(ğ•Š):
        ğ•ŠÊ³áµ˜Ë¡áµ‰Ë¢.itemsî®¦êŸ¿ó°²£(â€¹âŸ¦xâŸ§:â€ºâ˜¾, yâ˜¾)
    âŠ¢ print_normalized(ğ•Š):
        ğ•Šá´¿ áµ€ô‹•ŸÊ³áµ’áµ’áµ—â†¨ êŸ¿ó°²£ â˜¾â€¹âŸ¦xâŸ§ğ˜âŸ¦ğ˜€.join(yá´á”)âŸ§â€º

GRANDMA_RULES = Å•â‰”(â ¤map(re.compile, (('[\ueb26#][^\\n]*'), ('[â¯…â¯†â–³â–½â†·]'), ('"(â›.|[^"])*"'), ("'(â›.|[^'])*'"), ('â€¹(â›.|[^â€º])*â€º'), ('[^â¯…â¯†â–³â–½â†·ó°†´()?â—â®.:â ¶Æ¨âœ—+*=Â¬âˆ¨âˆ§~â€¹#î¬¦\'" \\t\\n]+|âœ—'), ('[ó°†´â—â®â ¶Æ¨~Â¬]'), ('[*+?]'), ('([ \\t]|â›\\n)+'), ('([ \\t\\n]|â›\\n)+'))),) â†’â–ºâ† â„µâˆ˜{'statements':('âˆ§',('?',('_W',)),('*',('âˆ§',('âˆ¨',('_comment',),('_elm_o',)),('?',('_W',))))),'comment':('~',Å•[0]),'elm_o':('âˆ§',('_elm_a',),('*',('âˆ§',('?',('_W',)),('á”','âˆ¨'),('?',('_W',)),('_elm_a',)))),'elm_a':('âˆ§',('_elm_j',),('*',('âˆ§',('âˆ¨',('âˆ§',('?',('_W',)),('á”','âˆ§'),('?',('_W',))),('?',('_w',))),('_elm_j',)))),'elm_j':('âˆ¨',('__elm_j',),('_elm',)),'_elm_j':('âˆ§',('_elm',),('?',('_W',)),('~',Å•[1]),('?',('_W',)),('âˆ¨',('__elm_j',),('_elm',))),'elm':('âˆ§',('_prefix',),('âˆ¨',('_assign_eql',),('_assign_cln',),('_group',),('_str',),('_rname',)),('_suffix',)),'assign_eql':('âˆ§',('_rname',),('?',('_W',)),('á”','='),('?',('_W',)),('_elm_o',)),'assign_cln':('âˆ§',('_rname',),('?',('_W',)),('á”',':'),('?',('_W',)),('_elm_j',)),'group':('âˆ§',('á”','('),('?',('_W',)),('_group_inner',),('á”',')')),'group_inner':('*',('âˆ§',('_elm_o',),('?',('_W',)))),'str1':('~',Å•[2]),'str2':('~',Å•[3]),'str3':('~',Å•[4]),'str':('âˆ¨',('_str1',),('_str2',),('_str3',)),'rname':('~',Å•[5]),'prefix':('âˆ¨',('âˆ§',('?',('_w',)),('+',('âˆ§',('~',Å•[6]),('?',('_W',))))),('?',('_w',))),'suffix':('âˆ¨',('âˆ§',('+',('âˆ§',('?',('_W',)),('~',Å•[7]))),('?',('_w',))),('?',('_w',))),'w':('~',Å•[8]),'W':('~',Å•[9])}
BOOTSTRAP = peggle2(GRANDMA_RULES)
FROM_GRAM = ó°²¡peggle2(gram_convert(BOOTSTRAP(x, "statements")))

__exports__ = "peggle2",

Â¿ __name__â‰¡"__main__":
    GRAM = ó°¦¥ó°¦¥ó°¦¥ó°¦¥ó°¦¥
    main    = ó°†´W? (entry ó°†´W?)*
    entry   = (
        Æ¨(section=ó°†´'[' wrd ó°†´']') ó°†´W?
        (pair = (
            (bruh:key = â ¶wrd) ó°†´(w? â†· '=')
            (value = (wrd âˆ¨ str)+) ó°†´W? ) )* )
    str     = ~â€¹"[^"]+"â€º
    wrd     = ~â€¹[-\w]+â€º
    w       = ~â€¹[ \t]+â€º
    W       = ~â€¹[ \t\n]+â€º
    ó°¦¥ó°¦¥ó°¦¥ó°¦¥ó°¦¥
    CONTENT = ó°¦¥ó°¦¥ó°¦¥ó°¦¥ó°¦¥
    [section1]
    somekey = somevalue
    someotherkey=someothervalue
    [duawhdiawi]
    somekey =                 somevalue
    someotherkey=âœ“â–¡awhdapi
    ó°¦¥ó°¦¥ó°¦¥ó°¦¥ó°¦¥
    RULE = "main"

    gram = peggle2(GRAM)â˜¾
    ó±• = gram(CONTENT, RULE)
    ó±•á´¾î®¦

âŠ¢ Peggle1Bootstrap(c=â„µ()):
    Â¿"BOOTSTRAP_PEGGLE1"âˆˆc:
        â†ª c.ForcefeedPeggle1peggle2, c.BOOTSTRAP_PEGGLE1
    
    âŠ¢ peggle122(rules):
        âŠ¢ Æ’(x):
            Â¿xáµ—â‰¡â›â†: â†ª (xáµ—, xâ‚€á¶œ, Æ’(xâ‚))
            Â¿xáµ—â‰¡"rname": â†ª (â›_â‹…(xá¶œâˆ‰â›âœ“â›âœ—)+xá¶œ, )
            â†ª xáµ—, â ¤((xá¶œ á´ Æ’) Â¿xá´¸Â¡ (xá¶œ, ))
        â†ª â„µ(rules) êŸ¿â±½ ó°²£Æ’(y)
    âŠ¢ peggle221(ó±•):
        â®Œ node â¨¡ Node
        âŠ¢ Æ’(ó±•):
            s = â„µ()
            âˆ€k,v âˆˆ ó±•áµ‰:
                Â¿kâ‰¡â›T: â†ªNode(c=ó±•áµ—)
                sô‹‘ºôŠ¬„ô‹•œáµ¢â‚™î â‚‘â‚“â‚áµ¥â‚ = k
            c = ó±•á´Æ’
            âˆ€i,vâˆˆs: cáµ¢áµ‰ = v
            â†ªNode(ó±•áµ—, c)
        â†ª Æ’(ó±•).find_replace(ó°²¡xğŸƒŒâ‰¡1 âˆ§ xá¶œâ‚€á¹Node âˆ§ Â¬xá¶œâ‚€áµ—, ó°²¡x.copy(c=xáµ—Ë£áµ—))

    ó±€˜ ForcefeedPeggle1Peggle2(peggle2):
        âŠ¢ __init__(ğ•Š, x):
            Â¿xá¹peggle2: super().__init__(x)
            Â¡         : super().__init__(peggle122(x))
        âŠ¢ __call__(ğ•Š, â ¤ğ”¸, â ¶ğ•‚):
            â†ª peggle221(super().__call__(â ¤ğ”¸, â ¶ğ•‚))
        âŠ¢ __or__(ğ•Š, x):
            â†ª super().__or__(peggle122(x))
        âŠ¢ dump_gram(ğ•Š):
            â†ª dumps((ğ‘‘âˆ˜ğ•ŠÊ³áµ˜Ë¡áµ‰Ë¢, ğ‘‘âˆ˜ğ•Šá´¿, ğ•Šá´¿.getdefî®¦))
        @ğ’â„³
        âŠ¢ load_gram(â„‚, gram):
            ğ•Š = â„‚.__new__(â„‚)
            rules, R, d = loads(gram)
            ğ•ŠÊ³áµ˜Ë¡áµ‰Ë¢, ğ•Šá´¿ = â„µ(rules), â„µáµˆ(R)
            â†ª ğ•Š

    c.ForcefeedPeggle1Peggle2 = ForcefeedPeggle1Peggle2
    c.BOOTSTRAP_PEGGLE1 = ForcefeedPeggle1Peggle2(BOOTSTRAP)
    c.Parser = ó°²¡ForcefeedPeggle1Peggle2(FROM_GRAM(x))
    â†ª c.ForcefeedPeggle1Peggle2, c.BOOTSTRAP_PEGGLE1, c.Parser