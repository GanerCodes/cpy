â®Œ types â¨¡ FunctionType as _FT
â®Œ sys â¨¡ _getframe
âŠ¢ ï‡Â´(n=0):
    frame = _getframe(n+1)
    â†ª _FT(frame.f_code, frame.f_globals)
î¬¦ ó°²¡1 Â¿xâ‰¤1Â¡ ğ“¢()(x-1)+ğ“¢()(x-2)ó°…‚(5)â˜¾

âŠ¢ outer_globals(i=0):
    â°ió·¸Š+1:
        G = _getframe(i).f_globals
        Â¿G["__file__"]â‰ __file__: â‡¥
    â†ª G

âŠ¢ ğ”¦ğ”ªğ”­(x): î¬¦ deprecated
    Â¿xâ‰¡â›s: î¬¦ system stuff
        â¨¡ os, sys, shutil, subprocess
        â®Œ pathlib â¨¡ Path as ğ©
        â®Œ subprocess â¨¡ Popen as ğ«
        â®Œ time â¨¡ time, sleep
        
        G = outer_globals()
        G[â›ğ©â¥‰PEV] = ğ©
        G[â›ğ«â¥‰PEV] = ğ«
        G[hâ‰”PEV("ğ©ğ")] = ğš²G["__file__"] â¥‰ğ©â†’.parent
        G["subprocess"] = subprocess
        G["os"], G["sys"], G["shutil"] = os, sys, shutil
        G["time"], G["sleep"] = time, sleep
        G["ldir"] = ğš²os.chdirâ†Gâ‚•î®¦

âŠ¢ ó± ¨(c, â ¤ğ”¸, get_ns=âœ—, ns=â–¡, fname=â–¡,
    interactive_ğ•‚=â–¡, no_isolate=âœ—,
    no_isolate_Æ’=ó°²¡exec(x,globals()), â ¶ğ•‚): î¬¦ ó± ¨(x, return_code=âœ“)
    
    ğ“˜ğ“š = {"code_post_process": __code_post_process__}|(interactive_ğ•‚ âˆ¨ {})
    â®Œ refresher â¨¡ basic_cpy_interactive_session
    cpy = basic_cpy_interactive_session(
        print_output=âœ“, ns=ns, fname=fnameâ‰…â–¡ â­œ"cpy_ó± ¨"â­ fname,
        code_cache_dir=__code_cache_dir__, gram_cache_dir=__gram_cache_dir__,
        header_carry=__header_namespace__, â ¶ğ“˜ğ“š)
    Â¿no_isolate: î¬¦ absolutely beaned
        Â¬get_ns âˆ§ nsâ‰…â–¡ âˆ§ fnameâ‰…â–¡ â¨³
        c = cpy(c, â ¤ğ”¸, return_code=âœ“, â ¶ğ•‚)â˜¾
        â†ª no_isolate_Æ’(c)
    r = cpy(c, â ¤ğ”¸, â ¶ğ•‚)
    â†ª cpyâ¿Ë¢ Â¿get_nsÂ¡ r

î¬¦ ğ”¸âˆ‹* âŸ¶ merge all (public) module contents with globals
î¬¦ ğ”¸âˆ‹- âŸ¶ don't set module itself as global (automatic w/ !)
î¬¦ ğ”¸âˆ‹! âŸ¶ store the object with module name into globals instead of module
î¬¦ g âŸ¶ store anything into globals
î¬¦ store_code âŸ¶ m.__cpy_code__ is the source code
î¬¦ ó·¹‡ var name __exports__ determines the default stuff to dump into namespace
âŠ¢ ó°‹º(ğ”£, â ¤ğ”¸, g=âœ“, store_code=âœ“, just_get_path=âœ—, just_get_code=âœ—):
    Â¬(just_get_path âˆ§ just_get_code) â¨³ î¬¦ ó°¤± return a tuple if both
    â®Œ sys â¨¡ path as P, _getframe as GF
    â®Œ os â¨¡ path, listdir
    â®Œ pathlib â¨¡ Path as ğ©
    f, drs = â–¡, (â›., â ¤P) áµâ¥‰ğ©â†’.resolve()á¸ ó°ˆ²ó·º¹.is_dir()
    âˆ€pâˆˆdrs:
        Â¿f â‰” â‹ â† á¦â‹„".â˜¾" á´ ó°²¡zâ‰”p/â€¹âŸ¦ğ”£âŸ§âŸ¦xâŸ§â€ºâ†’.is_file() âˆ§ zó°…‚: â‡¥
    f â¨³ â€¹Can't find "âŸ¦ğ”£âŸ§" in [âŸ¦", ".join(drsá–â€¹"âŸ¦âŸâŸ§"â€º)âŸ§]!â€º
    Â¿just_get_path: â†ªf
    with f.open() as ğŸ: code = ğŸ.read()
    Â¿just_get_code: â†ª code
    nam = PEV(na â‰” f.stem)
    m = â„µ(â ¶ó± ¨(â›î®+code, get_ns=âœ“, cap_stdout=âœ—, ns={"__name__": nam}, fname=á”â†f))
    ğ‘˜ = (m.keysî®¦ó°ˆ³ó°²¡xâ‚€â‰¡â›_) Â¿*âˆˆğ”¸Â¡ [â ¤ğ”¸ âˆ– {!}]
    ğ‘˜ó·¸Šó°Œ·("__exports__"âˆˆm.keysî®¦ â­œ[â ¤mô‹•Ÿô‹•Ÿáµ‰Ë£áµ–áµ’Ê³áµ—Ë¢ô‹•Ÿô‹•Ÿ]â­ â)
    Â¿store_code: mô‹•Ÿô‹•Ÿá¶œáµ–Ê¸ô‹•Ÿá¶œáµ’áµˆáµ‰ô‹•Ÿô‹•Ÿ = code
    Â¿g:
        G = outer_globals()
        âˆ€kâˆˆğ‘˜á´PEV:
            î¬¦ â€¹adding âŸ¦kâŸ§ from âŸ¦ğ”£âŸ§ to âŸ¦G["__file__"]âŸ§â€ºâ˜¾
            Gâ‚– = mâ‚–
        Â¿-âˆ‰ğ”¸ âˆ§ !âˆ‰ğ”¸ âˆ§ naâˆ‰ğ‘˜:
            Gâ‚™â‚â‚˜ = m
    Â¿!âˆˆğ”¸:
        namâˆˆm â¨³ â€¹Can't find "âŸ¦namâŸ§" inside module "âŸ¦f.stemâŸ§"!â€º
    â†ª m

â„³â„±_cache = {}
âŠ¢ â„³â„±(load):
    âŠ¢ Æ’(â ¤ğ”¸,â ¶ğ•‚):
        Â¿â„³â„±_cacheâˆ‹ğ“²â‰”id(load): ğ‘“ = â„³â„±_cacheô‹œ†
        Â¡                   : ğ‘“ = â„³â„±_cacheô‹œ† = loadî®¦
        â†ª ğ‘“(â ¤ğ”¸,â ¶ğ•‚)
    â†ª Æ’
SUBPROCA = â„³â„±(ğš²ó°‹º(â€¹subprocaâ€º).SUBPROCA)

î¬¦ ó°‹º(â€¹highlighterâ€º, !)
__builtins__["__error_printer__"] â‰” __error_printer__ â‰” â„³â„±(ğš²ó°‹º("highlighter").__error_printer__)
__builtins__["__highlighter__"  ] â‰” __highlighter__   â‰” â„³â„±(ğš²ó°‹º("highlighter").__highlighter__)
