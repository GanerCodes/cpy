â®Œ peggle â¨¡ Parser
ğŸŒˆ = ó°‹ºâˆ˜â›ğŸŒˆ
ó°‹º(â›ğ, â›ğ)

GRAM = â›
ó°¦¥ó°¦¥ó°¦¥ó°¦¥ó°¦¥
main = ó°†´Î©? ((rule âˆ¨ â ¶body_recurse) ó°†´Î©?)*

rule = rule_macro âˆ¨ â ¶rule_not_macro
rule_macro = Â¡ word ó°†´W? (â ¶(âŸ¶ (body_recurse âˆ¨ results) âˆ¨ rule_not_macro âˆ¨ body_recurse))

rule_not_macro = R_S_C âˆ¨ R_S_0 âˆ¨ R_C_S âˆ¨ R_C âˆ¨ R_S_1
R_S_C = ( â ¶style_hbra compose_head) (body_recurse âˆ¨ âœ“         âŸ¶? results)
R_S_0 = (           âœ“   style_head) (body_recurse âˆ¨ sty       âŸ¶? results)
R_C_S = (compose_head  â ¶style_hbra) (body_recurse âˆ¨ âœ“         âŸ¶? results)
R_C   = (compose_head            âœ“) (body_recurse âˆ¨ âœ“         âŸ¶? results)
R_S_1 = (           âœ“  â ¶style_hbra) (body_recurse âˆ¨ (sty âˆ¨ âœ“) âŸ¶? results)
body_recurse = â¦‘ â ¶main â¦’

style_hbra = â¦‘ style_head â¦’ ó°†´w?
style_head = â ¶tuple
tuple = ((| (| âœ“)*)? chain)+
pair  = Æ¨(word) ó°†´W? â¦‘ â ¶tuple? â¦’
chain = (pair âˆ¨ word)+ ó°†´W?

macref = ó°†´w? ó°†´"âŸ¨" ó°†´W? (Â¡ â¯† word) ó°†´W? ó°†´"âŸ©" ó°†´w?

results = ( âŸ¦ (â ¶results âˆ¨ ó°†´Î©)* âŸ§
            âˆ¨ macref
            âˆ¨ ((str âˆ¨ ~â€¹[^â "âŸ¦âŸ§âŸ¨âŸ©â¦‘â¦’\t\n ]â€º) ó°†´w?)+ )+
compose_head = â ¶(
    ( (looper = âŸ¦ â ¶compose_head âŸ§)
    âˆ¨ (concat = â… â ¶compose_head â†)
    âˆ¨ macref âˆ¨ lookup) ó°†´W?)+ ó°†´W?
lookup = Æ¨(str âˆ¨ chr âˆ¨ '|')
word   = Æ¨(str âˆ¨ chr+)
str    = Æ¨(esc âˆ¨ (ó°†´'"' ((esc âˆ¨ ~â€¹[^"]â€º)*) ó°†´'"'))
sty    = ó°†´w? â†· ~â€¹[ğ”â„œ]â€º
esc    = ó°†´â€¹â›â›â€º ~â€¹.?â€º

bad = ~â€¹[ğ”â„œâŸ¨âŸ©âŸ¦âŸ§â…â†â¦‘â¦’"|Â¡â âŸ¶\t\n ]â€º
chr = (Â¬bad) ~â€¹.â€º

(âŸ¦=ó°†´(W?â†·'âŸ¦'))(âŸ§=ó°†´(W?â†·'âŸ§'))(â…=ó°†´(W?â†·'â…'))(â†=ó°†´(W?â†·'â†'))
(â¦‘=ó°†´(W?â†·'â¦‘'))(â¦’=ó°†´(W?â†·'â¦’'))(âŸ¨=ó°†´(W?â†·'âŸ¨'))(âŸ©=ó°†´(W?â†·'âŸ©'))
(Â¡=ó°†´(W?â†·'Â¡'))(|=ó°†´(W?â†·'|'))(âŸ¶=ó°†´(W?â†·'âŸ¶'))(@=ó°†´(W?â†·'@'))
(,=ó°†´(W?â†·','))
w = ~â€¹[ \t]+â€º
W = ~â€¹[ \t\n]+â€º
Î© = ~â€¹[ \t\nâ ]+â€º
ó°¦¥ó°¦¥ó°¦¥ó°¦¥ó°¦¥

dat = â›
ó°¦¥ó°¦¥ó°¦¥ó°¦¥ó°¦¥
î¬¦ Ï‚Î˜Î¸Ï‘Î±Î²Î´âˆ‡âˆ‚Î”ÎµÎ·Ï†Ï•Î¦Î¹ÎºÎ»Î¼Ï€Î¨Î ÏˆÏÏƒÎ£Ï„Ï…Î½Ï‰Î©ÎÏ‡Î³Î“Î¶Î¾
î¬¦ !=make/append to macro
î¬¦ â€¼ï¸=make/append to macro, but also act as statement
î¬¦ in a seq, âŸ¨macâŸ© & âŸ¨@macâŸ© use macros but @mac tags the chars

!alpha  âŸ¦abcdefghijklmnopqrstuvwxyzâŸ§
!ALPHA  âŸ¦ABCDEFGHIJKLMNOPQRSTUVWXYZâŸ§
!number âŸ¦0123456789âŸ§
!letter âŸ¦âŸ¨@alphaâŸ©âŸ¨@ALPHAâŸ©âŸ§
!letnum âŸ¦âŸ¨@letterâŸ©âŸ¨@numberâŸ©âŸ§

î¬¦ "qâŸ¨@letnumâŸ© âŸ¶ ğ”¸ğ”¹â€¦" â‡’ ğ”¸âˆ‹letnum,letter,alpha

â€¼ï¸greek â¦‘câ¦‘A00â¦’â¦’ âŸ¶ {
    âŸ¦â…_sâ†â…0âŸ¦-á¦vâŸ§â†abâ…dâŸ¦egpá¦âŸ§â†â…eâŸ¦á¦tâŸ§â†â…fâŸ¦eiâŸ§â†â…Fiâ†â…ioâ†âŸ§ğ•Š
    âŸ¶  Ï‚    Î˜Î¸Ï‘  Î±Î²   Î´âˆ‡âˆ‚Î”     ÎµÎ·     Ï†Ï•    Î¦   Î¹
    âŸ¦klâ…muâ†â…pâŸ¦á¦sâŸ§â†â…PâŸ¦á¦sâŸ§â†â…rhâ†sStâ…upâ†vwWâ…xâŸ¦iá¦âŸ§â†yYzZâŸ§ğ•Š
    âŸ¶ÎºÎ»  Î¼    Ï€Î¨     Î Ïˆ    Ï ÏƒÎ£Ï„  Ï… Î½Ï‰Î©   ÎÏ‡  Î³Î“Î¶Î¾
}

â€¼ï¸dstruk qâŸ¨@letnumâŸ© âŸ¶ ğ”¸ğ”¹â„‚ğ”»ğ”¼ğ”½ğ”¾â„ğ•€ğ•ğ•‚ğ•ƒğ•„â„•ğ•†â„™â„šâ„ğ•Šğ•‹ğ•Œğ•ğ•ğ•ğ•â„¤ğ•’ğ•“ğ•”ğ••ğ•–ğ•—ğ•˜ğ•™ğ•šğ•›ğ•œğ•ğ•ğ•Ÿğ• ğ•¡ğ•¢ğ•£ğ•¤ğ•¥ğ•¦ğ•§ğ•¨ğ•©ğ•ªğ•«ğŸ˜ğŸ™ğŸšğŸ›ğŸœğŸğŸğŸŸğŸ ğŸ¡
w âŸ¶ {
    âŸ¦biâŸ§âŸ¦âŸ¨@letnumâŸ©â…á´âŸ¨@greekâŸ©â†âŸ§ âŸ¶ {
        !bold â¦‘câ¦‘ff9dc6â¦’â¦’ âŸ¶ âŸ¨
            ğšğ›ğœğğğŸğ ğ¡ğ¢ğ£ğ¤ğ¥ğ¦ğ§ğ¨ğ©ğªğ«ğ¬ğ­ğ®ğ¯ğ°ğ±ğ²ğ³ğ€ğğ‚ğƒğ„ğ…ğ†ğ‡ğˆğ‰ğŠğ‹ğŒğğğğğ‘ğ’ğ“ğ”ğ•ğ–ğ—ğ˜ğ™ğŸğŸğŸğŸ‘ğŸ’ğŸ“ğŸ”ğŸ•ğŸ–ğŸ—
            ğğğ·ğ‹ğ°ğ±ğ³ğ¯ğ‰ğ™ğ´ğ¶ğ…ğ«ğğ¸ğ¹ğºğ»ğ¿ğ‡ğ¥ğ­ğ€ğ‚ğ¨ğƒğ„ğ¼ğˆğ®ğ£ğ†ğ²ğ˜ğµğ½âŸ©
        !ital â¦‘câ¦‘f6b845â¦’â¦’ âŸ¶ âŸ¨
            ğ‘ğ‘ğ‘ğ‘‘ğ‘’ğ‘“ğ‘”â„ğ‘–ğ‘—ğ‘˜ğ‘™ğ‘šğ‘›ğ‘œğ‘ğ‘ğ‘Ÿğ‘ ğ‘¡ğ‘¢ğ‘£ğ‘¤ğ‘¥ğ‘¦ğ‘§ğ´ğµğ¶ğ·ğ¸ğ¹ğºğ»ğ¼ğ½ğ¾ğ¿ğ‘€ğ‘ğ‘‚ğ‘ƒğ‘„ğ‘…ğ‘†ğ‘‡ğ‘ˆğ‘‰ğ‘Šğ‘‹ğ‘Œğ‘â—Œâ—Œâ—Œâ—Œâ—Œâ—Œâ—Œâ—Œâ—Œâ—Œ
            ğœ¶ğœ·ğœ¸ğœ¹ğœºğœ»ğœ¼ğœ½ğ‘ğœ¾ğœ¿ğ€ğğ‚ğƒğ…ğ†ğ‡ğˆğ‰ğŠğ‹ğŒğğğğ“ğœğœŸğœµğœ£ğœ©ğœ«ğœ®ğœ±ğœ³ğœ´
        âŸ© }
    âŸ¦sfFmpâŸ§âŸ¨letnumâŸ© âŸ¶ {
        @math       â¦‘ â¦’ âŸ¶ ğ—®ğ—¯ğ—°ğ—±ğ—²ğ—³ğ—´ğ—µğ—¶ğ—·ğ—¸ğ—¹ğ—ºğ—»ğ—¼ğ—½ğ—¾ğ—¿ğ˜€ğ˜ğ˜‚ğ˜ƒğ˜„ğ˜…ğ˜†ğ˜‡ğ—”ğ—•ğ—–ğ——ğ—˜ğ—™ğ—šğ—›ğ—œğ—ğ—ğ—Ÿğ— ğ—¡ğ—¢ğ—£ğ—¤ğ—¥ğ—¦ğ—§ğ—¨ğ—©ğ—ªğ—«ğ—¬ğ—­ğŸ¬ğŸ­ğŸ®ğŸ¯ğŸ°ğŸ±ğŸ²ğŸ³ğŸ´ğŸµ
        @frak       â¦‘ â¦’ âŸ¶ ğ”ğ”Ÿğ” ğ”¡ğ”¢ğ”£ğ”¤ğ”¥ğ”¦ğ”§ğ”¨ğ”©ğ”ªğ”«ğ”¬ğ”­ğ”®ğ”¯ğ”°ğ”±ğ”²ğ”³ğ”´ğ”µğ”¶ğ”·ğ”„ğ”…â„­ğ”‡ğ”ˆğ”‰ğ”Šâ„Œâ„‘ğ”ğ”ğ”ğ”ğ”‘ğ”’ğ”“ğ””â„œğ”–ğ”—ğ”˜ğ”™ğ”šğ”›ğ”œâ„¨â—Œâ—Œâ—Œâ—Œâ—Œâ—Œâ—Œâ—Œâ—Œâ—Œ
        @frak @bold â¦‘ â¦’ âŸ¶ ğ–†ğ–‡ğ–ˆğ–‰ğ–Šğ–‹ğ–Œğ–ğ–ğ–ğ–ğ–‘ğ–’ğ–“ğ–”ğ–•ğ––ğ–—ğ–˜ğ–™ğ–šğ–›ğ–œğ–ğ–ğ–Ÿğ•¬ğ•­ğ•®ğ•¯ğ•°ğ•±ğ•²ğ•³ğ•´ğ•µğ•¶ğ•·ğ•¸ğ•¹ğ•ºğ•»ğ•¼ğ•½ğ•¾ğ•¿ğ–€ğ–ğ–‚ğ–ƒğ–„ğ–…â—Œâ—Œâ—Œâ—Œâ—Œâ—Œâ—Œâ—Œâ—Œâ—Œ
        @mathscript â¦‘ â¦’ âŸ¶ ğ’¶ğ’·ğ’¸ğ’¹â„¯ğ’»â„Šğ’½ğ’¾ğ’¿ğ“€ğ“ğ“‚ğ“ƒâ„´ğ“…ğ“†ğ“‡ğ“ˆğ“‰ğ“Šğ“‹ğ“Œğ“ğ“ğ“ğ’œâ„¬ğ’ğ’Ÿâ„°â„±ğ’¢â„‹â„ğ’¥ğ’¦â„’â„³ğ’©ğ’ªğ’«ğ’¬â„›ğ’®ğ’¯ğ’°ğ’±ğ’²ğ’³ğ’´ğ’µâ—Œâ—Œâ—Œâ—Œâ—Œâ—Œâ—Œâ—Œâ—Œâ—Œ
        @para       â¦‘Nâ¦’ âŸ¶ â’œâ’â’â’Ÿâ’ â’¡â’¢â’£â’¤â’¥â’¦â’§â’¨â’©â’ªâ’«â’¬â’­â’®â’¯â’°â’±â’²â’³â’´â’µğŸ„ğŸ„‘ğŸ„’ğŸ„“ğŸ„”ğŸ„•ğŸ„–ğŸ„—ğŸ„˜ğŸ„™ğŸ„šğŸ„›ğŸ„œğŸ„ğŸ„ğŸ„ŸğŸ„ ğŸ„¡ğŸ„¢ğŸ„£ğŸ„¤ğŸ„¥ğŸ„¦ğŸ„§ğŸ„¨ğŸ„©â—Œâ‘´â‘µâ‘¶â‘·â‘¸â‘¹â‘ºâ‘»â‘¼ }
    @circle âŸ¶ {
        wcâŸ¨letnumâŸ© â¦‘Nâ¦’  âŸ¶ â“â“‘â“’â““â“”â“•â“–â“—â“˜â“™â“šâ“›â“œâ“â“â“Ÿâ“ â“¡â“¢â“£â“¤â“¥â“¦â“§â“¨â“©â’¶â’·â’¸â’¹â’ºâ’»â’¼â’½â’¾â’¿â“€â“â“‚â“ƒâ“„â“…â“†â“‡â“ˆâ“‰â“Šâ“‹â“Œâ“â“â“â—Œâ—Œó°²¡ó°²£ó°²¥ó°²§ó°²©ó°²«ó°²­ó°²¯ó°²± }
    @circle_alt_numbers âŸ¶ {
        wCâŸ¨numberâŸ© â¦‘Nâ¦’  âŸ¶ â“ªâ‘ â‘¡â‘¢â‘£â‘¤â‘¥â‘¦â‘§â‘¨ } }

ó°¦¥ó°¦¥ó°¦¥ó°¦¥ó°¦¥

î¬¦ EEEâŸ¨joeâŸ© âŸ¶ EE
î¬¦ aâŸ¦Aâ…âŸ¦abcâŸ§âŸ¦cdâŸ§âŸ¨macâŸ©â†âŸ§ âŸ¶ 0123
î¬¦ â¦‘câ¦‘Aâ¦’uâ¦’ â„œ âŸ¶ abceâŸ¨joeâŸ©ef"asda"â›"a
î¬¦ Â¡ abc âŸ¶ abcdefg
î¬¦ á´abc âŸ¶ hiâ›aa"aaa"âŸ¨mac1Â¡mac2âŸ©joe

fargs = Æ’â†¦Æ’.__code__.co_varnames[:Æ’.__code__.co_argcount]
gen, gens = nâ†¦Æ’â†¦gensâ‚™â‰”Æ’, {}
gen(â›c)â†â¥Œx=â–¡,y=â–¡,z=â–¡â†¦{ â ¶xâˆ§{          "color": ğŸŒˆ.h2hlâ†x}âˆ¨{},
                       â ¶yâˆ§{"backgroundColor": ğŸŒˆ.h2hlâ†y}âˆ¨{},
                       â ¶zâˆ§{    "borderColor": ğŸŒˆ.h2hlâ†z}âˆ¨{} }
gen(â›B)â†â¥Œx,y=1,r=1â†¦â„µ(borderStyle  = â€¹sâ€‰solidâŸdâ€‰dashedâ€ºâ­â¥‰ğ‘‘â†’â‚“,
                     borderWidth  = â€¹âŸ¦yâŸ§pxâ€º,
                     borderRadius = â€¹âŸ¦râŸ§pxâ€º)
gen(â›b)â†ğš²â„µ(fontStyle="bold")
gen(â›u)â†â¥Œx=1â†¦â„µ(textDecoration=â€¹underline âŸ¦xâŸ§pxâ€º)
âŠ¢ decor(n):
    R = []
    âˆ€nâˆˆn:
        r = {}
        âˆ€nâˆˆn:
            t, v = náµ—, ná¶œ
            Â¿t â‰¡ "word":
                r |= gens[vâ‚€áµ—]î®¦
            â¸˜t â‰¡ "pair":
                t, c = vâ‚€áµ—, vâ‚á¶œ
                É™ = c á´ó°²¡â–¡ Â¿xáµ—â‰¡â›âœ“Â¡ ğ˜€.join(x.extract(ó°²¡Â¬xá¶œ,Î”=âœ—)á´ó°²¡xáµ—)
                Æ’ = gensâ‚œ
                r |= Æ’(â ¶{k:vâˆ€k,vâˆˆfargs(Æ’)Î¶É™Â¿kâ‰‡â–¡})
        R += râ›¶
    â†ª R

âŠ¢ RCR(Î¹, f, r):
    Â¿Î¹á¹ğ‘¡â†’Â¬: â†ªÎ¹
    Î½ = Î¹â†¦(Î¹â‚€, Î¹â‚ á´ó°²¡RCR(x,f,r) Â¿xá¹ğ‘™Â¡ x)
    â†ª râˆ˜Î¹ Â¿fâˆ˜Î¹Â¡ Î½âˆ˜Î¹

âŠ¢ parse_compose_node(n):
    Â¿náµ—â‰¡"lookup": â†ª [[nâ‚€áµ—]]
    Â¿náµ—â‰¡"macref": â†ª [[ná´ó°²¡xáµ—]]
    seqs = n á´ parse_compose_node
    Â¿náµ—â‰¡"looper": â†ª seqsÎ£[]
    â†ª seqsÅ¿ó°²£xâ¨‰yêŸ¿+

head_types = â€¹R_S_Câ€‰R_S_0â€‰R_C_Sâ€‰R_Câ€‰R_S_1â€ºâ­
âŠ¢ parse(dat, gram=Parser(GRAM)):
    dat = ğ—».joinâ†dat.split(ğ—»)ó°ˆ³ó°²¡x.lstrip().startswithâ†â›î¬¦ó°…‚
    root = gram(dat, DEBUG=âœ—)
    root = root.child_killer(ó°²¡xáµ—âˆˆğ‘ â†â€¹â„œÂ¡|â›âŸ¦â›âŸ§â…â†â¦‘â¦’âŸ¨âŸ©âŸ¶â€º)
    root = root.find_replace(ó°²¡âœ“, ó°²¡(xáµ—âˆ§(xáµ—,xá¶œ)âˆ¨(xá¶œ,[])))
    root = (repâ‰”ó°²¡ğ(x)Â¿xá¹á”Â¡ğ(xâ‚€,â ¤xâ‚á´rep))âˆ˜root
    root = root.ftrp("strâ€‰word"â­, ó°²¡x.copy(xáµ—, c=[ğ(xá´ó°²¡xáµ—ó°…‚Î£á¦)]))
    root = root.ftrp("R_S_C"â­, ó°²¡x.copy(c=[xâ‚,xâ‚€,â ¤xâ‚‚ï¹•]))
    root = root.ftrp("results"â­,
        ó°²¡x.ftrp("str", ó°²¡ğ(xâ‚€áµ—)))
    root = root.ftrp("macref"â­,
        ó°²¡x.ftrp("macref", ó°²¡x.copy(c=xá´ó°²¡xâ‚€)))
    
    âŠ¢ adjust_headhead(n):
        c, s, â ¤n = n
        â†ª ğ("head",
            ğ([] Â¿cáµ—â‰¡â›âœ“Â¡ parse_compose_node(c)),
            ğ({} Â¿sáµ—â‰¡â›âœ“Â¡ decor(s)),
            â ¤n)
    root = root.ftrp(head_types, adjust_headhead, âœ“)
    
    root, rgx_rules = root.extract(
        ó°²¡xáµ—â‰¡"rule" âˆ§ (Î±â‰”xâ‚€)áµ—â‰¡"head" âˆ§ (Î±â‰”Î±â‚‚â†’ áµ—)â‰¡"sty" âˆ§ Î±â‚€áµ—â‰¡â›â„œ, Î”=âœ“)
    rgx_rules á´= ó°²¡x.copy(c=(Î±â‰”ğ‘™âˆ˜xâ‚€)â‚áµ—â‹„Î±â‚ƒ)
    
    conv_res = ó°²¡x á´ó°²¡x á´ó°²¡ xáµ—ó°…‚ Â¿xğŸƒŒÂ¡ xáµ—
    
    rgx_rules êŸ¿= ó°²£(x, conv_res(y))
    root = root.frp(ó°²¡xáµ—â‰¡"head"âˆ§xâ‚‚áµ—â‰ "body_recurse", ó°²¡x.copy(c=[xá¶œâ‚€,xá¶œâ‚,xá¶œâ‚ƒ]))
    
    root, macros = root.extract(ó°²¡xáµ—â‰¡"rule"âˆ§xâ‚€áµ—â‰¡"rule_macro", Î”=âœ“, pre=âœ“)
    macros á´= ó°²¡xâ‚€
    
    r = macros î®† ğ‘â—‹ó°²¡xâ‚€áµ—â‰¡"word" âˆ§ xâ‚áµ—â‰¡"results"
    macros, strmacs = r.get(â´´, []), r.get(â´³, [])
    strmacs = strmacs î®†ó°²¡xâ‚€ â‚€áµ—ó°…‚ á´â±½ó°²¡conv_res(xâ‚€ â‚ )
    
    macros = macros á´ó°²¡(xâ‚€ â‚€áµ—, xâ‚ï¹•)ó°…‚ â¥‰ğ‘‘
    
    all_rules = strmacs | macros | {"ROOT": root.copy("body_recurse")}
    
    î¬¦ all_rules.itemsî®¦êŸ¿ó°²£â€¹âŸ¦xâŸ§â€ºâ˜¾â–ºyá´ó°²¡x.Pî®¦â˜¾
    
    âˆ€k,vâˆˆall_rules.itemsî®¦:
        â€¹âŸ¦kâŸ§:ğ—»âŸ¦vâŸ§â€ºâ˜¾
    
    â†ª root

parseâˆ˜dat
î¬¦ â†’ á´¾î®¦â˜¾
ğŸŸ‘
ó°¤±: the rest â­—ô‹•â­—
ğŸŸ‘