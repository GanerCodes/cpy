GRAM = â›
ó°¦¥ó°¦¥ó°¦¥ó°¦¥ó°¦¥
main = ó°†´W? â†· â ¶atom

atom = macadd âˆ¨ macref âˆ¨ results âˆ¨ style âˆ¨ looper âˆ¨ concat âˆ¨ lookup

macadd = Â¡ (ó°†´',' â¯† word) ó°†´W? (â ¶atom)
macref = âŸ¨ (
      (macref_tag  =(ó°†´@ word))
    âˆ¨ (macref_notag=(   word))
) âŸ©

results = ó°†´ó°… (ó°†´W âˆ¨ str âˆ¨ ~â€¹[^ó°…‚]â€º)* ó°†´ó°…‚

style = â¦‘ (â ¶tuple âˆ¨ âœ“) â¦’ ó°†´w?
tuple = ((| (| âœ“)*)? chain)+
pair  = Æ¨(word) ó°†´W? â¦‘ â ¶tuple? â¦’
chain = (pair âˆ¨ word)+ ó°†´W?

looper = âŸ¦ (â ¶atom)* âŸ§
concat = â… (â ¶atom)* â†
lookup = str âˆ¨ Æ¨(chr âˆ¨ '|' âˆ¨ ',')
word   = Æ¨(str âˆ¨ chr+)
str    = Æ¨(â ¶esc âˆ¨ (ó°†´'"' ((esc âˆ¨ ~â€¹[^"]â€º)*) ó°†´'"'))
esc    = ó°†´â€¹â›â›â€º ~â€¹.?â€º

chr = (Â¬bad) ~â€¹.â€º
bad = ~â€¹[âŸ¨âŸ©âŸ¦âŸ§â…â†â¦‘â¦’"|Â¡,\t\n ]â€º

w = ~â€¹[ \t]+â€º
W = ~â€¹[ \t\n]+â€º

(âŸ¦=ó°†´(W?â†·'âŸ¦'))(âŸ§=ó°†´(W?â†·'âŸ§'))(â…=ó°†´(W?â†·'â…'))(â†=ó°†´(W?â†·'â†'))
(â¦‘=ó°†´(W?â†·'â¦‘'))(â¦’=ó°†´(W?â†·'â¦’'))(âŸ¨=ó°†´(W?â†·'âŸ¨'))(âŸ©=ó°†´(W?â†·'âŸ©'))
(ó°…=ó°†´(W?â†·'ó°…'))(ó°…‚=ó°†´(W?â†·'ó°…‚'))(âŸ¶=ó°†´(W?â†·'âŸ¶'))(Â¡=ó°†´(W?â†·'Â¡'))
(|=ó°†´(W?â†·'|'))(@=ó°†´(W?â†·'@'))(,=ó°†´(W?â†·','))
ó°¦¥ó°¦¥ó°¦¥ó°¦¥ó°¦¥

DAT = â›
ó°¦¥ó°¦¥ó°¦¥ó°¦¥ó°¦¥
âŸ¦

Â¡alpha âŸ¦abcdefghijklmnopqrstuvwxyzâŸ§
Â¡ALPHA âŸ¦ABCDEFGHIJKLMNOPQRSTUVWXYZâŸ§
Â¡numberâŸ¦0123456789                âŸ§
Â¡letterâŸ¦âŸ¨@alphaâŸ©âŸ¨@ALPHAâŸ©          âŸ§
Â¡letnumâŸ¦âŸ¨@letterâŸ©âŸ¨@numberâŸ©        âŸ§
Â¡greek â…â¦‘câ¦‘A00â¦’â¦’âŸ¦
  â…âŸ¦â…_sâ†â…0âŸ¦-á¦vâŸ§â†abâ…dâŸ¦egpá¦âŸ§â†â…eâŸ¦á¦tâŸ§â†â…fâŸ¦eiâŸ§â†â…Fiâ†â…ioâ†âŸ§ğ•Š
   ó°…  Ï‚    Î˜Î¸Ï‘  Î±Î²   Î´âˆ‡âˆ‚Î”     ÎµÎ·     Ï†Ï•    Î¦   Î¹  ó°…‚â†
  â…âŸ¦klâ…muâ†â…pâŸ¦á¦sâŸ§â†â…PâŸ¦á¦sâŸ§â†â…rhâ†sStâ…upâ†vwWâ…xâŸ¦iá¦âŸ§â†yYzZâŸ§ğ•Š
   ó°…ÎºÎ»  Î¼    Ï€Î¨     Î Ïˆ    Ï ÏƒÎ£Ï„  Ï… Î½Ï‰Î©   ÎÏ‡  Î³Î“Î¶Î¾ ó°…‚â†
âŸ§â†
Â¡lngeekâŸ¦âŸ¨@letnumâŸ©â…á´âŸ¨@greekâŸ©â†      âŸ§

Â¡dstruk â…qâŸ¨@letnumâŸ©ó°…ğ”¸ğ”¹â„‚ğ”»ğ”¼ğ”½ğ”¾â„ğ•€ğ•ğ•‚ğ•ƒğ•„â„•ğ•†â„™â„šâ„ğ•Šğ•‹ğ•Œğ•ğ•ğ•ğ•â„¤ğ•’ğ•“ğ•”ğ••ğ•–ğ•—ğ•˜ğ•™ğ•šğ•›ğ•œğ•ğ•ğ•Ÿğ• ğ•¡ğ•¢ğ•£ğ•¤ğ•¥ğ•¦ğ•§ğ•¨ğ•©ğ•ªğ•«ğŸ˜ğŸ™ğŸšğŸ›ğŸœğŸğŸğŸŸğŸ ğŸ¡ó°…‚â†

â…wâŸ¦
  Â¡bold â…bâŸ¨lngeekâŸ© â¦‘câ¦‘ff9dc6â¦’â¦’ ó°…
    ğšğ›ğœğğğŸğ ğ¡ğ¢ğ£ğ¤ğ¥ğ¦ğ§ğ¨ğ©ğªğ«ğ¬ğ­ğ®ğ¯ğ°ğ±ğ²ğ³ğ€ğğ‚ğƒğ„ğ…ğ†ğ‡ğˆğ‰ğŠğ‹ğŒğğğğğ‘ğ’ğ“ğ”ğ•ğ–ğ—ğ˜ğ™ğŸğŸğŸğŸ‘ğŸ’ğŸ“ğŸ”ğŸ•ğŸ–ğŸ—
    ğğğ·ğ‹ğ°ğ±ğ³ğ¯ğ‰ğ™ğ´ğ¶ğ…ğ«ğğ¸ğ¹ğºğ»ğ¿ğ‡ğ¥ğ­ğ€ğ‚ğ¨ğƒğ„ğ¼ğˆğ®ğ£ğ†ğ²ğ˜ğµğ½ ó°…‚ â†
  Â¡ital â…iâŸ¨lngeekâŸ© â¦‘câ¦‘f6b845â¦’â¦’ ó°…
    ğ‘ğ‘ğ‘ğ‘‘ğ‘’ğ‘“ğ‘”â„ğ‘–ğ‘—ğ‘˜ğ‘™ğ‘šğ‘›ğ‘œğ‘ğ‘ğ‘Ÿğ‘ ğ‘¡ğ‘¢ğ‘£ğ‘¤ğ‘¥ğ‘¦ğ‘§ğ´ğµğ¶ğ·ğ¸ğ¹ğºğ»ğ¼ğ½ğ¾ğ¿ğ‘€ğ‘ğ‘‚ğ‘ƒğ‘„ğ‘…ğ‘†ğ‘‡ğ‘ˆğ‘‰ğ‘Šğ‘‹ğ‘Œğ‘â—Œâ—Œâ—Œâ—Œâ—Œâ—Œâ—Œâ—Œâ—Œâ—Œ
    ğ‡ğœ£ğœ½ğ‘ğœ¶ğœ·ğœ¹ğœµğğœŸğœºğœ¼ğ‹ğœ±ğ“ğœ¾ğœ¿ğ€ğğ…ğğœ«ğœ³ğ†ğˆğœ®ğ‰ğŠğ‚ğğœ´ğœ©ğŒğœ¸ğœğœ»ğƒ ó°…‚ â†
  Â¡math,bold  â…sâŸ¨@letnumâŸ©     ó°…ğ—®ğ—¯ğ—°ğ—±ğ—²ğ—³ğ—´ğ—µğ—¶ğ—·ğ—¸ğ—¹ğ—ºğ—»ğ—¼ğ—½ğ—¾ğ—¿ğ˜€ğ˜ğ˜‚ğ˜ƒğ˜„ğ˜…ğ˜†ğ˜‡ğ—”ğ—•ğ—–ğ——ğ—˜ğ—™ğ—šğ—›ğ—œğ—ğ—ğ—Ÿğ— ğ—¡ğ—¢ğ—£ğ—¤ğ—¥ğ—¦ğ—§ğ—¨ğ—©ğ—ªğ—«ğ—¬ğ—­ğŸ¬ğŸ­ğŸ®ğŸ¯ğŸ°ğŸ±ğŸ²ğŸ³ğŸ´ğŸµó°…‚â†
  Â¡frak       â…fâŸ¨@letnumâŸ©     ó°…ğ”ğ”Ÿğ” ğ”¡ğ”¢ğ”£ğ”¤ğ”¥ğ”¦ğ”§ğ”¨ğ”©ğ”ªğ”«ğ”¬ğ”­ğ”®ğ”¯ğ”°ğ”±ğ”²ğ”³ğ”´ğ”µğ”¶ğ”·ğ”„ğ”…â„­ğ”‡ğ”ˆğ”‰ğ”Šâ„Œâ„‘ğ”ğ”ğ”ğ”ğ”‘ğ”’ğ”“ğ””â„œğ”–ğ”—ğ”˜ğ”™ğ”šğ”›ğ”œâ„¨â—Œâ—Œâ—Œâ—Œâ—Œâ—Œâ—Œâ—Œâ—Œâ—Œó°…‚â†
  Â¡frak,bold  â…FâŸ¨@letnumâŸ©     ó°…ğ–†ğ–‡ğ–ˆğ–‰ğ–Šğ–‹ğ–Œğ–ğ–ğ–ğ–ğ–‘ğ–’ğ–“ğ–”ğ–•ğ––ğ–—ğ–˜ğ–™ğ–šğ–›ğ–œğ–ğ–ğ–Ÿğ•¬ğ•­ğ•®ğ•¯ğ•°ğ•±ğ•²ğ•³ğ•´ğ•µğ•¶ğ•·ğ•¸ğ•¹ğ•ºğ•»ğ•¼ğ•½ğ•¾ğ•¿ğ–€ğ–ğ–‚ğ–ƒğ–„ğ–…â—Œâ—Œâ—Œâ—Œâ—Œâ—Œâ—Œâ—Œâ—Œâ—Œó°…‚â†
  Â¡mathscript â…mâŸ¨@letnumâŸ©     ó°…ğ’¶ğ’·ğ’¸ğ’¹â„¯ğ’»â„Šğ’½ğ’¾ğ’¿ğ“€ğ“ğ“‚ğ“ƒâ„´ğ“…ğ“†ğ“‡ğ“ˆğ“‰ğ“Šğ“‹ğ“Œğ“ğ“ğ“ğ’œâ„¬ğ’ğ’Ÿâ„°â„±ğ’¢â„‹â„ğ’¥ğ’¦â„’â„³ğ’©ğ’ªğ’«ğ’¬â„›ğ’®ğ’¯ğ’°ğ’±ğ’²ğ’³ğ’´ğ’µâ—Œâ—Œâ—Œâ—Œâ—Œâ—Œâ—Œâ—Œâ—Œâ—Œó°…‚â†
  Â¡para       â…pâŸ¨@letnumâŸ© â¦‘Nâ¦’ ó°…â’œâ’â’â’Ÿâ’ â’¡â’¢â’£â’¤â’¥â’¦â’§â’¨â’©â’ªâ’«â’¬â’­â’®â’¯â’°â’±â’²â’³â’´â’µğŸ„ğŸ„‘ğŸ„’ğŸ„“ğŸ„”ğŸ„•ğŸ„–ğŸ„—ğŸ„˜ğŸ„™ğŸ„šğŸ„›ğŸ„œğŸ„ğŸ„ğŸ„ŸğŸ„ ğŸ„¡ğŸ„¢ğŸ„£ğŸ„¤ğŸ„¥ğŸ„¦ğŸ„§ğŸ„¨ğŸ„©â—Œâ‘´â‘µâ‘¶â‘·â‘¸â‘¹â‘ºâ‘»â‘¼ó°…‚â†
  Â¡circle     â…câŸ¨@letnumâŸ© â¦‘Nâ¦’ ó°…â“â“‘â“’â““â“”â“•â“–â“—â“˜â“™â“šâ“›â“œâ“â“â“Ÿâ“ â“¡â“¢â“£â“¤â“¥â“¦â“§â“¨â“©â’¶â’·â’¸â’¹â’ºâ’»â’¼â’½â’¾â’¿â“€â“â“‚â“ƒâ“„â“…â“†â“‡â“ˆâ“‰â“Šâ“‹â“Œâ“â“â“â—Œó°²¡ó°²£ó°²¥ó°²§ó°²©ó°²«ó°²­ó°²¯ó°²±ó°…‚â†
  Â¡circlen2   â…CâŸ¨@numberâŸ© â¦‘Nâ¦’ ó°…                                                    â“ªâ‘ â‘¡â‘¢â‘£â‘¤â‘¥â‘¦â‘§â‘¨ó°…‚â†
âŸ§â†
âŸ§
ó°¦¥ó°¦¥ó°¦¥ó°¦¥ó°¦¥

â®Œ peggle â¨¡ Parser
ğŸŒˆ = ó°‹ºâˆ˜â›ğŸŒˆ
ó°‹º(â›ğ, â›ğ)

fargs = Æ’â†¦Æ’.__code__.co_varnames[:Æ’.__code__.co_argcount]
gen, gens = nâ†¦Æ’â†¦gensâ‚™â‰”Æ’, {}
gen(â›c)â†â¥Œx=â–¡,y=â–¡,z=â–¡â†¦{ â ¶xâˆ§{          "color": ğŸŒˆ.h2hlâ†x}âˆ¨{},
                       â ¶yâˆ§{"backgroundColor": ğŸŒˆ.h2hlâ†y}âˆ¨{},
                       â ¶zâˆ§{    "borderColor": ğŸŒˆ.h2hlâ†z}âˆ¨{} }
gen(â›B)â†â¥Œx,y=1,r=1â†¦â„µ(borderStyle  = â€¹sâ€‰solidâŸdâ€‰dashedâ€ºâ­â¥‰ğ‘‘â†’â‚“,
                     borderWidth  = â€¹âŸ¦yâŸ§pxâ€º,
                     borderRadius = â€¹âŸ¦râŸ§pxâ€º)
gen(â›b)â†ğš²â„µ(fontStyle="bold")
gen(â›N)â†ğš²â„µ(NO_SCALE=â´³)
gen(â›u)â†â¥Œx=1â†¦â„µ(textDecoration=â€¹underline âŸ¦xâŸ§pxâ€º)
âŠ¢ decor(n):
    R = []
    âˆ€nâˆˆn:
        r = {}
        âˆ€nâˆˆn:
            t, v = náµ—, ná¶œ
            Â¿t â‰¡ "word":
                r |= gens[vâ‚€áµ—]î®¦
            â¸˜t â‰¡ "pair":
                t, c = vâ‚€áµ—, vâ‚á¶œ
                É™ = c á´ó°²¡â–¡ Â¿xáµ—â‰¡â›âœ“Â¡ ğ˜€.join(x.extract(ó°²¡Â¬xá¶œ,Î”=âœ—)á´ó°²¡xáµ—)
                Æ’ = gensâ‚œ
                r |= Æ’(â ¶{k:vâˆ€k,vâˆˆfargs(Æ’)Î¶É™Â¿kâ‰‡â–¡})
        R += râ›¶
    â†ª R

âŠ¢ RCR(Î¹, f, r):
    Â¿Î¹á¹ğ‘¡â†’Â¬: â†ªÎ¹
    Î½ = Î¹â†¦(Î¹â‚€, Î¹â‚ á´ó°²¡RCR(x,f,r) Â¿xá¹ğ‘™Â¡ x)
    â†ª râˆ˜Î¹ Â¿fâˆ˜Î¹Â¡ Î½âˆ˜Î¹

î¬¦ â†ª [seq]
î¬¦ seq = [style|tag|chr|str]
î¬¦ mac { "macname": [seq] }
âŠ¢ supermcdoublerecursivecomposeoutputstyleparsemachine(
        n, pre=â–¡, mac=â–¡, res=â–¡):
    
    mac, pre, res = {}Â¿macâ‰…â–¡Â¡mac, []Â¿preâ‰…â–¡Â¡pre, []Â¿resâ‰…â–¡Â¡res
    ğ•¤ = ğš²supermcdoublerecursivecomposeoutputstyleparsemachine(â ¤ğ”¸,mac=mac,res=res)
    Â¿náµ—â‰¡"main":
        ğ•¤(nâ‚€,pre)
        â†ª mac, res
    Â¿náµ—â‰¡"looper": â†ª ná´ó°²¡ğ•¤(x,pre)ó°…‚Î£[]
    Â¿náµ—â‰¡"concat":
        seqs, L = [pre], ná´ó°²¡x
        â°L:
            N = L.popâˆ˜0
            nseqs = []
            âˆ€pâˆˆseqs:
                nseqs += ğ•¤(N, p) î¬¦ [seq]
            seqs = nseqs
        â†ª seqs
    Â¿náµ—â‰¡"style":  â†ª [pre+nâ‚€ â›¶]
    Â¿náµ—â‰¡"lookup": â†ª [pre+(("LIT", nâ‚€ â‚€áµ—)Â¿nâ‚€áµ—â‰¡"str"Â¡nâ‚€áµ—)â›¶] î¬¦ ó°¤± strs (ó·¹‡ they special!)
    Â¿náµ—â‰¡"results":
        C, â ¤ná¶œ = n
        res.append((pre, Câ‚€áµ—Â¿CğŸƒŒÂ¡C))
        â†ª [pre]
    Â¿náµ—â‰¡"macadd":
        â ¤w, s = n
        seqs = ğ•¤(s, pre)
        w á´ó°²¡mac.setdefault(xâ‚€áµ—,[]).extend(seqs)
        â†ª seqs
    Â¿náµ—â‰¡"macref":
        n = nâ‚€
        val = mac[nam â‰” nâ‚€ â‚€áµ— Öó°¤±ôŠ½¨Ö]
        Â¿náµ—â‰¡"macref_tag":
            pre += [("TAG", nam)]
        Â¡:
            val á´= ó°²¡x ó°ˆ³ó°²¡xá¹ğ‘¡âˆ§xâ‚€â‰¡"TAG"
        â†ª val á´ó°²¡pre+x

head_types = â€¹R_S_Câ€‰R_S_0â€‰R_C_Sâ€‰R_Câ€‰R_S_1â€ºâ­
âŠ¢ parse(dat, gram=Parser(GRAM)):
    dat = ğ—».joinâ†dat.split(ğ—»)ó°ˆ³ó°²¡x.lstrip().startswithâ†â›î¬¦ó°…‚
    
    dat = dat.replace(ğ—», ğ˜€)
    âˆ€iâˆˆâ­¥5: dat = dat.replace(ğ˜€â‹…2, ğ˜€)
    
    root = gram(dat, DEBUG=âœ—)
    root = root.child_killer(ó°²¡xáµ—âˆˆğ‘ â†â€¹â„œÂ¡|â›âŸ¦â›âŸ§â…â†â¦‘â¦’âŸ¨âŸ©âŸ¶â€º)
    root = root.find_replace(ó°²¡âœ“, ó°²¡(xáµ—âˆ§(xáµ—,xá¶œ)âˆ¨(xá¶œ,[])))
    root = (repâ‰”ó°²¡ğ(x)Â¿xá¹á”Â¡ğ(xâ‚€,â ¤xâ‚á´rep))âˆ˜root
    root = root.ftrp("strâ€‰word"â­, ó°²¡x.copy(xáµ—, c=[ğ(xá´ó°²¡xáµ—ó°…‚Î£á¦)]))
    root = root.ftrp("style", ó°²¡x.copy(c=[ğ(decor(x))]))
    â€¹Parsed!â€ºâ˜¾
    mac, lets = supermcdoublerecursivecomposeoutputstyleparsemachine(root)
    mac.itemsî®¦êŸ¿ó°²£â€¹âŸ¦xâŸ§: âŸ¦yâŸ§â€ºâ˜¾
    letsêŸ¿ó°²£â€¹âŸ¦xâŸ§: "âŸ¦yâŸ§"â€ºâ˜¾
    â†ª lets, mac

parseâˆ˜DAT

ğŸŸ‘
ó°¤±: the
ğŸŸ‘