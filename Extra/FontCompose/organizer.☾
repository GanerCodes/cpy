î¬¦ partition pua
î¬¦ sup/sub partitioning

ğ”¦ğ”ªğ”­âˆ˜â›s

cmsr = ó°‹º(â ¤â€¹composerâ€‰xcompose_from_seqsâ€‰symmapâ€‰generate_composeâ€ºâ­)

â¨¡ json
â®Œ platform â¨¡ uname
â®Œ random â¨¡ randint, seed
seedâˆ˜unameî®¦â‚

pua = 0x100000 â‹„ 0x10FFFD î¬¦ we own this plane

puaÎ” = puaâ‚€ + randint(0, puaá´™ â‰º- â†’â‹….9 â¥‰ ğ‘–)
oâ‰”puaâ‚€â‹„puaÎ”â‹„puaâ‚ á´hex â†’â–ºâ† â€¹Offset: âŸ¦oâ‚€âŸ§ â‰¤ âŸ¦oâ‚âŸ§ < âŸ¦oâ‚‚âŸ§â€ºâ˜¾

pua_fold = ğ©ğî®¦ / â€¹PuaMapsâ€º
lmâ‰”{} â†’â–ºâ† pua_maps_in â‰” ğ‘™âˆ˜pua_fold.glob("*.json") â›
            â†’á´ ó°²¡json.load(x.openî®¦) â›
                â†’êŸ¿á´·ó°²¡x.splitâˆ˜â›| á´ó°²¡ğ‘–(x,16)ó°…‚ â¥‰ğ‘¡ó°…‚ â›
                â†’.itemsî®¦ êŸ¿ó°²£xâ‚€â€¦xâ‚Î¶y êŸ¿â¥Œl,câ†¦
                (câ‰¡lmâ‚— â¨³ â€¹âŸ¦câŸ§â†’âŸ¦lâŸ§â†âŸ¦lmâ‚—âŸ§â€º) Â¿lâˆˆlmÂ¡ lmâ‚—â‰”c
ml = lm êŸ¿á´° ó°²£(y,x)

âŠ¢ pua_single(ğ”¡):
    global puaÎ”
    Â¿ğ”¡âˆˆml: â†ª lm, ml
    puaÎ” -= 1
    â°puaÎ”+=1:
        Â¿puaÎ”âˆ‰lm: â‡¥
    lm[puaÎ”], ml[ğ”¡] = ğ”¡, puaÎ”
    â†ª lm, ml

âŠ¢ pua_conseq(ğ”¡): î¬¦ á”s to be together
    global lm, ml
    ğ”¡ ó°ˆ³= ó°²¡xâˆˆml
    ğ• = puaÎ”-1
    â°ğ•+=1:
        Â¿Â¬ğ• â‰” (I â‰” ğ”¡â­¥á´ó°²¡ğ•+x) ó°‘… ó°²¡xâˆˆlmó°…‚: â‡¥
    lm |= ğ‘‘â†IÎ¶ğ”¡
    ml |= ğ‘‘â†ğ”¡Î¶I
    â†ª lm, ml

to_ranges = lmâ†¦[
        s â‰” lm ó°’¼ â†’ â‚€,
       â ¤s á™§ 0â‹„1 êŸ¿ó°²£x+1â‰ yâˆ§(x+1,y)ó°…‚ ó°ˆ²âŸ¤ Î£(),
        sâ‚‹â‚+1
    ] á™§Â¹ êŸ¿ó°²£((x,y), xâ€¦yá´ó°²¡lmâ‚“ó°…‚)ó°…‚ â¥‰ ğ‘‘

âŠ¢ save_pua():
    lms = to_ranges(lm) êŸ¿á´·ó°²£ â€¹âŸ¦hex(xâ‚€)âŸ§|âŸ¦hex(xâ‚)âŸ§â€º
    t = timeî®¦â‹…100 â¥‰ğ‘–
    pua_maps_in á´ ó°²¡x.rename(y â‰” pua_fold/â€¹Old/âŸ¦tâŸ§_âŸ¦x.nameâŸ§â€º) â–º â€¹Moved "âŸ¦xâŸ§"â†¦"âŸ¦yâŸ§"â€ºâ˜¾
    json.dump(lms, (dâ‰”pua_fold/â€¹pua_log.jsonâ€º)â†’.openâˆ˜â›w)
    â€¹Wrote pua mapping to "âŸ¦dâŸ§"â€ºâ˜¾
    â†ª lms

get_codepoint = â¥Œc,pâ†¦pua_single(nâ‰”â€¹âŸ¦pâŸ§_âŸ¦câŸ§â€º) â–ºâ† (chrâ†mlâ‚™,n,c)
get_codepoints = â¥ŒC,pâ†¦pua_conseq(Nâ‰”Cá´ó°²¡â€¹âŸ¦pâŸ§_âŸ¦xâŸ§â€º) â–ºâ† NÎ¶CêŸ¿ó°²£(chrâ†mlâ‚“,x,y)ó°…‚

âŠ¢ get_new_chars(force_include, no_scale, multichars,
                ignore_scripts, special_symkeys):
    ğ’ = generate_compose(no_write=â´³)
    
    â„­ = ğ’.itemsî®¦ ó°ˆ²ó°²¡xâ‚ğŸƒŒâ‰¡1ó°…‚ êŸ¿ó°²£(y,x)ó°…‚ â¥‰ ğ‘‘
    get_seq = ó°²¡xâˆˆâ„­âˆ§â„­â‚“ âˆ¨ xâˆˆsymmapâˆ§x
    
    supsub = (â„­ âˆª special_symkeys) âˆ– ignore_scripts ó°’¼
    sub = get_codepoints(    supsub, "sub") êŸ¿ó°²¥ (x,y,z,xâˆˆâ„­âˆ§â„­â‚“ âˆ¨â†  (jâ‰”get_seqâ†z) âˆ§ â›/â‹…(1+â†zâˆ‰special_symkeys)+(zâ‰¡â›/âˆ§â›ğ•Šâˆ¨j), xâˆ‰no_scale)
    sup = get_codepoints(    supsub, "sup") êŸ¿ó°²¥ (x,y,z,xâˆˆâ„­âˆ§â„­â‚“ âˆ¨â†  (jâ‰”get_seqâ†z) âˆ§ â›\â‹…(1+â†zâˆ‰special_symkeys)+(zâ‰¡â›\âˆ§â›ğ•Šâˆ¨j), xâˆ‰no_scale)
    mul = get_codepoints(multichars, "mul") êŸ¿ó°²¥ (x,y,z,xâˆˆâ„­âˆ§â„­â‚“ âˆ¨â† â‹€(Kâ‰”zá´get_seq) âˆ§ â›á´+(Ká´ó°²¡x+â›ğ•Šó°…‚Î£á¦))
    S = subâ‹„supâ‹„mul
    â†ª ğ’ | ğ‘‘(S Å¿+ ó°ˆ²ó°²¡xâ‚ƒó°…‚ êŸ¿ó°²§(w,(x,y))), â ¤S