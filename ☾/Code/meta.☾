IMPSIMPS = ((â›â„, â€¹â„ó·¸™ó·¸˜ó·¸›ó·¸šó·¸—ó·¸–ó·¸œó·¸•Äµó·ºˆó·±½ó·±¾â€º),)
DISABLE_AUTOIMP = â€¹kotsâ€‰â„â€‰HEADERâ€ºâ­
IMPIMPMAP = ğ‘‘(IMPSIMPSêŸ¿ó·º¹â‹„áµœó·º¾â†’ó°Œ·)

â®Œ types â¨¡ FunctionType as _FT
â®Œ sys â¨¡ _getframe
âŠ¢ ï‡Â´(n=0):
    frame = _getframe(n+1)
    â†ª _FT(frame.f_code, frame.f_globals)
î¬¦ ó°²¡1 Â¿xâ‰¤1Â¡ ğ“¢()(x-1)+ğ“¢()(x-2)ó°…‚(5)â˜¾

âŠ¢ outer_globals(i=0):
    â°ió·¸Š+1:
        ğ˜ = _getframe(i).f_globals
        Â¿ğ˜[â€¹__file__â€º]â‰ __file__: â‡¥
    â†ª ğ˜

âŠ¢ ğ”¦ğ”ªğ”­(x): î¬¦ deprecated
    Â¿xâ‰¡â›s: î¬¦ system stuff
        â¨¡ os, sys, shutil, subprocess
        â®Œ pathlib â¨¡ Path as ğ©
        â®Œ subprocess â¨¡ Popen as ğ«
        â®Œ time â¨¡ time, sleep
        
        G = outer_globals()
        G[â›ğ©â¥‰PEV] = ğ©
        G[â›ğ«â¥‰PEV] = ğ«
        G[hâ‰”PEV("ğ©ğ")] = ğš²G[â€¹__file__â€º] â¥‰ğ©â†’.parent
        G["subprocess"] = subprocess
        G["os"], G["sys"], G["shutil"] = os, sys, shutil
        G["time"], G["sleep"] = time, sleep
        G["ldir"] = ğš²os.chdirâ†Gâ‚•î®¦

âŠ¢ ó± ¨(c, â ¤ğ”¸, get_ns=âœ—, ns=â–¡, fname=â–¡,
    interactive_ğ•‚=â–¡, no_isolate=âœ—,
    no_isolate_Æ’=ó°²¡exec(x,globals()), â ¶ğ•‚): î¬¦ ó± ¨(x, return_code=âœ“)
    
    ğ“˜ğ“š = {"code_post_process": __code_post_process__}|(interactive_ğ•‚ âˆ¨ {})
    â®Œ refresher â¨¡ basic_cpy_interactive_session
    cpy = basic_cpy_interactive_session(
        print_output=âœ“, ns=ns, fname=fnameâ‰…â–¡ â­œ"cpy_ó± ¨"â­ fname,
        code_cache_dir=__code_cache_dir__, gram_cache_dir=__gram_cache_dir__,
        header_carry=__header_namespace__, â ¶ğ“˜ğ“š)
    Â¿no_isolate: î¬¦ absolutely beaned
        Â¬get_ns âˆ§ nsâ‰…â–¡ âˆ§ fnameâ‰…â–¡ â¨³
        c = cpy(c, â ¤ğ”¸, return_code=âœ“, â ¶ğ•‚)â˜¾
        â†ª no_isolate_Æ’(c)
    r = cpy(c, â ¤ğ”¸, â ¶ğ•‚)
    â†ª get_ns â­œcpyâ¿Ë¢â­ r

âŠ¢ get_implict_imports(code): î¬¦ so what if you import stuff by accident this wont need fixing in a month
    Â¿ğ‘ (IMPIMPMAP.itemsî®¦áµâ‚€âˆˆcodeâˆ§IMPORTED_âˆŒâŸâ‚â­œâŸâ‚â­ó°®ˆ) â‰• auto_imports:
        â†ª â€¹(â€¹âŸ¦auto_importsâ¨â›â€‰âŸ§â›â€ºâ­á´ó°‹º)â€º

î¬¦ ğ”¸âˆ‹* âŸ¶ merge all (public) module contents with globals
î¬¦ ğ”¸âˆ‹- âŸ¶ don't set module itself as global (automatic w/ !)
î¬¦ ğ”¸âˆ‹! âŸ¶ store the object with module name into globals instead of module
î¬¦ g âŸ¶ store anything into globals
î¬¦ store_code âŸ¶ m.__cpy_code__ is the source code
î¬¦ ó·¹‡ var name __exports__ determines the default stuff to dump into namespace
î¬¦ ó°¤± bug that store_code doesn't work if found in cache
âŠ¢ ó°‹º(ğ”£, â ¤ğ”¸, g=âœ“, store_code=âœ“, just_get_path=âœ—):
    â®Œ sys â¨¡ path as ğ˜—
    â®Œ pathlib â¨¡ Path as ğ©
    
    ğ˜ = outer_globals()
    ğ™³ = [â›., â ¤ğ˜—]
    Â¿ğ˜.get(â€¹__file__â€º)â‰•fp:
        ğ™³.append(ğ©(fp).parent)
    ğ™³ ó·¸Š á´ğ©áµ.resolve()á¸ ó°ˆ²ó·º¹.is_dir()á¸ â­¢ áš¤
    ğš, ğ™²ğ™·ğ™º = â–¡, â
    âˆ€p,e âˆˆ ğ™³â¨‰â€¹â€‰.â˜¾â€ºâ­:
        f = p/â€¹âŸ¦ğ”£âŸ§âŸ¦eâŸ§â€º
        Â¿f.is_dir():
            Â¿ ğ™²ğ™·ğ™º.append(hâ‰”f/â€¹main.â˜¾â€º)â–ºh.is_file()â›
             âˆ¨ğ™²ğ™·ğ™º.append(hâ‰”f/â€¹âŸ¦ğ”£âŸ§ó·º—.â˜¾â€º)â–ºh.is_file():
                ğš,ğš— = h,PEV(ğš—ğšŠâ‰”f.stem)
                â‡¥
            â†º
        ğ™²ğ™·ğ™º.append(f)
        Â¿f.is_file():
            ğš,ğš— = f,PEV(ğš—ğšŠâ‰”f.stem)
            â‡¥
    ğš â¨³ â€¹Can't find "âŸ¦ğ”£âŸ§", files checked:âŸ¦ğ™²ğ™·ğ™ºâŸ•ğ—»ğ˜âŸ§â€º
    Â¿just_get_path: â†ªğš
    Â¿ğšâˆˆIMPORTED_:
        Â¿IMPORTED_ô€²¤â‰•ğ˜”â‰…â–¡: â†ª
    Â¡:
        ğšŒğš˜ğšğš = â“¦(ğš.open(), ó·º¹.read())
        Î© Module(â„µÂ´ ô‹‡‘): __repr__ = ğš²â€¹Module "âŸ¦ğš—ğšŠâŸ§"â€º
        ns = {â€¹__name__â€º:ğš—, â€¹__file__â€º:ğš, â€¹__dir__â€º:ğš.parent}
        IMPORTED_ô€²¤ = â–¡
        ğ˜” = Module(â ¶ó± ¨(â›î®+ğšŒğš˜ğšğš, get_ns=âœ“, cap_stdout=âœ—, ns=ns, fname=á”(ğš)))
        IMPORTED_ô€²¤ = importsô€²´ô€²š = ğ˜”
        Â¿store_code: ğ˜”[â€¹__cpy_code__â€º] = ğšŒğš˜ğšğš
    ğ‘˜ = *âˆˆğ”¸ â­œğ˜”â»ó°ˆ³ó°²¡xâ‚€â‰¡â›_ó°…‚â­ [â ¤ğ”¸ âˆ– {!}]
    ğ‘˜ó·¸Šó°Œ·("__exports__"âˆˆğ˜”â» â­œ[â ¤ğ˜”[â€¹__exports__â€º]]â­ â)
    Â¿g:
        âˆ€kâˆˆğ‘˜:
            K = PEV(k)
            î¬¦ â€¹âŸ¦â€¹âœ—âœ“â€ºó°‚ôŠ®‡â‚˜âŸ§: Adding "âŸ¦kâŸ§"(âŸ¦KâŸ§) from âŸ¦ğ”£âŸ§ to âŸ¦ğ˜[â€¹__file__â€º]âŸ§â€ºâ˜¾
            Â¿Kâˆˆğ˜”: ğ˜ó°‚ = ğ˜”ó°‚
            Â¡   : â€¹Warning, âŸ¦kâŸ§âˆ‰âŸ¦ğ˜”âŸ§â€ºâ˜¾
        Â¿-âˆ‰ğ”¸âˆŒ! âˆ§ ğš—ğšŠâˆ‰ğ‘˜:
            ğ˜ô€²´ = ğ˜”
    !âˆ‰ğ”¸ âˆ¨ ğš—âˆˆğ˜” â¨³ â€¹Can't find "âŸ¦ğš—âŸ§" inside module "âŸ¦ğš—ğšŠâŸ§"!â€º
    â†ª ğ˜”

â„³â„±_cache = {}
âŠ¢ â„³â„±(load):
    âŠ¢ Æ’(â ¤ğ”¸,â ¶ğ•‚):
        Â¿â„³â„±_cacheâˆ‹ğ“²â‰”id(load): ğ‘“ = â„³â„±_cacheô‹œ†
        Â¡                   : ğ‘“ = â„³â„±_cacheô‹œ† = loadî®¦
        â†ª ğ‘“(â ¤ğ”¸,â ¶ğ•‚)
    â†ª Æ’
SUBPROCA = â„³â„±(ğš²ó°‹º(â€¹subprocaâ€º).SUBPROCA)

kots = ó°‹º("kots")
âˆ€nâˆˆkots[â€¹__exports__â€º]:
    ğš— = PEV(n)
    globals()ô€²´ = __builtins__ô€²´ = kotsô€²´
highlighter = ó°‹º("highlighter")

__builtins__["__error_printer__"] â‰” __error_printer__ â‰” highlighter.__error_printer__
__builtins__["__highlighter__"  ] â‰” __highlighter__   â‰” highlighter.__highlighter__